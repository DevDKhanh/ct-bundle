System.register("chunks:///_virtual/KKAuthBundle",["./KKAuthLayer.ts","./KKLoginPopup.ts"],(function(){return{setters:[null,null],execute:function(){}}}));

System.register("chunks:///_virtual/KKAuthLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LayerBase.ts","./GameData.ts","./kk.ts","./RandomTextUtil.ts","./KKHttpCenter.ts","./KKHttpRoute.ts","./KKGameUIConf.ts","./KKUtils.ts"],(function(t){var e,n,r,a,o,s,u,i,c,l,h,p,f,g,d,m;return{setters:[function(t){e=t.inheritsLoose,n=t.asyncToGenerator,r=t.regeneratorRuntime,a=t.extends},function(t){o=t.cclegacy,s=t._decorator},function(t){u=t.LayerBase},function(t){i=t.default},function(t){c=t.default},function(t){l=t.RandomTextUtil},function(t){h=t.httpCenter},function(t){p=t.HttpRoute},function(t){f=t.KKAuthPopupConf,g=t.KKHomePopupConf,d=t.KKLayerConf},function(t){m=t.default}],execute:function(){var y;o._RF.push({},"305catlipNAIr8q6stRvlFp","KKAuthLayer",void 0);var v=s.ccclass;s.property,t("KKAuthLayer",v("KKAuthLayer")(y=function(t){function o(){for(var e,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))||this).layer=null,e}e(o,t);var s=o.prototype;return s.onLoad=function(){this.layer=this.getObj("layer")},s.start=function(){var t=n(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.handleLogin();case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),s.handleRegister=function(){var t=n(r().mark((function t(e,n){var o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.reqAsync(p.register,{body:{username:e,password:n},method:"POST"});case 2:if(201!=(o=t.sent).statusCode){t.next=8;break}return this.handleLoginGame(a({},o.data,{password:n})),t.abrupt("return",!0);case 8:return console.log("Đăng ký tài khoản thất bại",o),t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),s.handleLoginRequest=function(){var t=n(r().mark((function t(e,n){var o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.reqAsync(p.login,{body:{username:e,password:n},method:"POST"});case 2:if(200!=(o=t.sent).statusCode){t.next=8;break}return this.handleLoginGame(a({},o.data,{password:n})),t.abrupt("return",!0);case 8:return this.layer.active=!0,c.localMgr.removeItem("token"),c.localMgr.removeItem("username"),c.localMgr.removeItem("password"),m.showToast("Xác thực tài khoản thất bại"),t.abrupt("return",!1);case 14:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),s.handleLoginGame=function(){var t=n(r().mark((function t(e){var n=this;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i.setELo(e.elo),i.setELo(e.eloBanqi,!0),i.login({id:e.id,username:e.username,token:e.jwt,gold:e.gold,goldFree:e.goldFree,password:e.password,refreshToken:e.jwtRefresh,displayName:e.displayName}),i.isLoggedIn?c.uiMgr.preLoadLayerAsync(d.Home).then((function(){n.layer.active=!1,c.uiMgr.goLayerAsync(d.Home)})):(this.layer.active=!0,c.localMgr.removeItem("token"),c.localMgr.removeItem("username"),c.localMgr.removeItem("password"),m.showToast("Xác thực tài khoản thất bại"));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),s.handleLogin=function(){var t=n(r().mark((function t(){var e,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=c.localMgr.getItemWithDefault("username",null,!0),n=c.localMgr.getItemWithDefault("password",null,!0),e&&n){t.next=7;break}return t.next=5,this.autoCreateAccount();case 5:t.next=9;break;case 7:return t.next=9,this.handleLoginRequest(e,n);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),s.autoCreateAccount=function(){var t=n(r().mark((function t(){var e,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e="ngoalong"+l.radomNumber(10),n=l.radomText(10),t.next=4,this.handleRegister(e,n);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),s.refresh=function(){var t,e,a,o=this;null!=(t=this.recvData)&&t.isLogout&&(i.logout(),this.layer.active=!0,m.showCommonPopup({desc:"Tài khoản của bạn đã được đăng nhập trên thiết bị khác",title:"Thông báo",btnTxt:"Đăng nhập lại",btnTxtCls:"Tạo tài khoản mới",hideCloseCorner:!0,btnCall:(a=n(r().mark((function t(){var e,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=c.localMgr.getItemWithDefault("username",null,!0),n=c.localMgr.getItemWithDefault("password",null,!0),!e||!n){t.next=7;break}return t.next=5,o.handleLoginRequest(e,n);case 5:t.sent&&c.uiMgr.goLayerAsync(d.Home);case 7:case"end":return t.stop()}}),t)}))),function(){return a.apply(this,arguments)}),closeCall:(e=n(r().mark((function t(){var e,n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=l.radomText(10),n=l.radomNumber(10),t.next=4,o.handleRegister(e,n);case 4:t.sent&&c.uiMgr.goLayerAsync(d.Home);case 6:case"end":return t.stop()}}),t)}))),function(){return e.apply(this,arguments)})})),this.recvData.logout&&(i.logout(),this.layer.active=!0)},s.onBtnClick=function(t,e){switch(e){case"auto-login":this.autoCreateAccount();break;case"setting":c.uiMgr.showPopupAsync(g.Setting);break;case"login":c.uiMgr.showPopupAsync(f.Login)}},o}(u))||y);o._RF.pop()}}}));

System.register("chunks:///_virtual/KKLoginPopup.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PopupBase.ts","./GameData.ts","./KKGameUIConf.ts","./kk.ts","./KKHttpCenter.ts","./KKHttpRoute.ts","./KKUtils.ts"],(function(e){var t,n,r,o,a,s,i,u,l,c,p,f,g,h,d,m,w;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,r=e.initializerDefineProperty,o=e.assertThisInitialized,a=e.asyncToGenerator,s=e.regeneratorRuntime,i=e.extends},function(e){u=e.cclegacy,l=e._decorator,c=e.EditBox},function(e){p=e.PopupBase},function(e){f=e.default},function(e){g=e.KKLayerConf},function(e){h=e.default},function(e){d=e.httpCenter},function(e){m=e.HttpRoute},function(e){w=e.default}],execute:function(){var y,v,I,K,L,k,b;u._RF.push({},"a58a7x1Jv9HE7uN/MmkPY5z","KKLoginPopup",void 0);var M=l.ccclass,P=l.property;e("KKLoginPopup",(y=M("KKLoginPopup"),v=P(c),I=P(c),y((k=t((L=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return t=e.call.apply(e,[this].concat(a))||this,r(t,"usernameInput",k,o(t)),r(t,"passwordInput",b,o(t)),t}n(t,e);var u=t.prototype;return u.onLoad=function(){this.enableClickBlankToClose();var e=h.localMgr.getItemWithDefault("username",null,!0),t=h.localMgr.getItemWithDefault("password",null,!0);(e||t)&&(this.usernameInput.string=e,this.passwordInput.string=t)},u.handleLoginRequest=function(){var e=a(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=3;break}return w.showToast("Vui lòng nhập đầy đủ thông tin"),e.abrupt("return",!1);case 3:return e.next=5,d.reqAsync(m.login,{body:{username:t,password:n},method:"POST"});case 5:200==(r=e.sent).statusCode?(this.close(),this.handleLoginGame(i({},r.data,{password:n}))):(h.localMgr.removeItem("token"),h.localMgr.removeItem("username"),h.localMgr.removeItem("password"),w.showToast("Xác thực tài khoản thất bại"));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),u.handleLoginGame=function(){var e=a(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f.setELo(t.elo),f.setELo(t.eloBanqi,!0),f.login({id:t.id,username:t.username,token:t.jwt,gold:t.gold,goldFree:t.goldFree,password:t.password,refreshToken:t.jwtRefresh,displayName:t.displayName}),f.isLoggedIn?h.uiMgr.preLoadLayerAsync(g.Home).then((function(){h.uiMgr.goLayerAsync(g.Home)})):(h.localMgr.removeItem("token"),h.localMgr.removeItem("username"),h.localMgr.removeItem("password"),w.showToast("Xác thực tài khoản thất bại"));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u.start=function(){},u.onBtnClick=function(e,t){switch(t){case"login":var n=this.usernameInput.string,r=this.passwordInput.string;this.handleLoginRequest(n,r)}},t}(p)).prototype,"usernameInput",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b=t(L.prototype,"passwordInput",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=L))||K));u._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/KKAuthBundle', 'chunks:///_virtual/KKAuthBundle'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});