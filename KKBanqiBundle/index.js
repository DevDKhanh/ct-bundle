System.register("chunks:///_virtual/KKBanqiBundle",["./KKBanqiLayer.ts"],(function(){return{setters:[null],execute:function(){}}}));

System.register("chunks:///_virtual/KKBanqiLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LayerBase.ts","./GameCoTuongData.ts","./GameData.ts","./KKGameUIConf.ts","./kk.ts","./AsyncHelper.ts","./CocosHelper.ts","./SpriteNumber.ts","./KKUtils.ts","./SocketEvent.ts","./SocketIO.ts","./GameManager.ts","./KKEndGamePopup.ts","./KKAvatarWidget.ts","./ObjectPooling.ts","./KKPieceWidget.ts"],(function(e){var t,n,i,o,r,a,s,l,c,u,p,d,f,h,y,m,g,b,w,v,P,C,E,K,k,R,T,D,N,A,x,L,I,B,O,G,M;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized,r=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){s=e.cclegacy,l=e._decorator,c=e.Node,u=e.Label,p=e.v3,d=e.UITransform},function(e){f=e.LayerBase},function(e){h=e.default,y=e.Side,m=e.RoomStatus},function(e){g=e.default},function(e){b=e.KKCoTuongPopupConf,w=e.KKHomePopupConf,v=e.KKLayerConf,P=e.KKCoTuongPanelConf,C=e.KKCoTuongWidgetlConf},function(e){E=e.default},function(e){K=e.default},function(e){k=e.secondsToMinute,R=e.coin},function(e){T=e.SpriteNumber},function(e){D=e.default},function(e){N=e.SocketEvent,A=e.typeSocket,x=e.actionID},function(e){L=e.default},function(e){I=e.GameManager},function(e){B=e.EFFECT},function(e){O=e.KKAvatarWidget},function(e){G=e.default},function(e){M=e.KKPieceWidget}],execute:function(){var F,S,z,q,V,W,H,U,j,_,J,Y,Q,X,Z,$,ee,te,ne,ie,oe,re,ae,se,le;s._RF.push({},"c224eppq81PzJ4rojNNw4R5","KKBanqiLayer",void 0);var ce=l.ccclass,ue=l.property;e("KKBanqiLayer",(F=ce("KKBanqiLayer"),S=ue(c),z=ue(u),q=ue(u),V=ue(c),W=ue(c),H=ue({type:[c],displayName:"Ảnh chữ sẵn sàng",tooltip:"[0] => Me; [1] => Other Player"}),U=ue({type:[u],displayName:"Lable hiển thị thời gian",tooltip:"[0] => Me; [1] => Other Player"}),j=ue({type:[O],displayName:"Sprite hiển thị thời gian",tooltip:"[0] => Me; [1] => Other Player"}),_=ue({type:[c],displayName:"Pool chứa pieces",tooltip:"[0] => Me; [1] => Other Player"}),J=ue({type:[u],displayName:"Lable hiển thị elo",tooltip:"[0] => Me; [1] => Other Player"}),Y=ue(T),F((Z=t((X=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t=e.call.apply(e,[this].concat(r))||this,i(t,"otherPlayer",Z,o(t)),i(t,"otherName",$,o(t)),i(t,"myName",ee,o(t)),i(t,"controller",te,o(t)),i(t,"waiting",ne,o(t)),i(t,"spReady",ie,o(t)),i(t,"lbTimes",oe,o(t)),i(t,"spCountdown",re,o(t)),i(t,"poolPieces",ae,o(t)),i(t,"lbElo",se,o(t)),i(t,"time",le,o(t)),t.isShowEffect=!1,t}n(t,e);var s=t.prototype;return s.onLoad=function(){var e,t;this.time=this.getObj("controller.time",T),h.isLeaveRoom=!1,h.isViewer=null==(e=this.recvData)?void 0:e.isViewer,h.id=null==(t=this.recvData)?void 0:t.roomID},s.start=function(){var e=r(a().mark((function e(){var t,n,i,o=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h.isViewer||(L.on(N.peace,(function(){E.uiMgr.showPopupAsync(b.CauHoa)})),L.on(N.peaceAnswer,(function(){o.showEnd(B.hoa),o.spCountdown[0].startFill(0,!1),o.spCountdown[1].startFill(0,!1)})),L.on(N.messageCoTuong,(function(e){D.showToast(e)})),L.on(N.banqiData,(function(e){e.my&&e.other&&o.renderPieces(e)}))),L.reqAsync(N.actions,{type:A.coUp,actionID:x.joinRoom,roomID:null==(t=this.recvData)?void 0:t.roomID}),L.on(N.dataRoom,r(a().mark((function e(t){var n,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.id!=h.id&&null!=h&&h.id||h.isLeaveRoom)){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,!t){e.next=23;break}if(o.waiting.active=t.status==m.WAITING&&!h.isViewer,t.fen&&(h.fen=t.fen),h.isViewer){e.next=21;break}if(null!=t&&null!=(n=t.players)&&n.some((function(e){return(null==e?void 0:e.id)==g.info.id}))?(h.setData(t),o.updateLayer()):(h.leaveRoom(),o.goBackHome(),console.log("dataRoom go back",t)),null==t||!t.loser){e.next=19;break}if(i=t.loser.id==g.info.id,!E.uiMgr.getPopup(b.EndGame)&&!o.isShowEffect){e.next=13;break}return e.abrupt("return");case 13:return o.isShowEffect=!0,e.next=16,K.sleepAsync(.8);case 16:i?o.showEnd(B.thua):o.showEnd(B.thang),o.spCountdown[0].startFill(0,!1),o.spCountdown[1].startFill(0,!1);case 19:e.next=23;break;case 21:h.setData(t),o.updateInfoPlayerForViewer();case 23:e.next=30;break;case 25:e.prev=25,e.t0=e.catch(2),h.leaveRoom(),o.goBackHome(),console.log("dataRoom go back",e.t0);case 30:case"end":return e.stop()}}),e,null,[[2,25]])})))),L.on(N.countDown,r(a().mark((function e(t){var n,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id==h.id||null==h||!h.id){e.next=2;break}return e.abrupt("return");case 2:i=null==t||null==(n=t.players)?void 0:n.find((function(e){return e.isReady&&e.id==g.info.id})),o.time&&(o.time.value=t.countdown),h.isViewer||(t.status!=m.COUNTDOWN?o.controller.active=!1:o.controller.active=!i),t.status==m.PLAYING?o.updatePlaying(t):t.status!=m.COUNTDOWN&&t.status!=m.WAITING||(o.waiting.active=t.status==m.WAITING);case 6:case"end":return e.stop()}}),e)})))),n=this.getObj("ban"),e.next=7,E.uiMgr.createPanelAsync(P.BanCo,{isBanqi:!0});case 7:i=e.sent,n.addChild(i),this.getObj("menu.xin-hoa-button").active=!h.isViewer,this.getObj("menu.btn-doi").active=h.isViewer;case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.onDestroy=function(){L.off(N.dataRoom),L.off(N.peace),L.off(N.peaceAnswer),L.off(N.countDown),L.off(N.messageCoTuong),L.off(N.banqiData)},s.showEnd=function(e){var t,n,i,o;E.uiMgr.showPopupAsync(b.EndGame,{effect:e,name:null!=(t=null==(n=h.cloneOtherPlayer)?void 0:n.displayname)?t:null==(i=h.cloneOtherPlayer)?void 0:i.username,elo:null==(o=h.cloneOtherPlayer)?void 0:o.elo})},s.renderPieces=function(e){var t=this,n=e.my,i=e.other;this.poolPieces[0]&&this.poolPieces[1]?(this.poolPieces[0].children.forEach((function(e){G.putNode(e)})),this.poolPieces[1].children.forEach((function(e){G.putNode(e)})),n.forEach(r(a().mark((function e(n,i){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.createPiece(n,t.poolPieces[0],-i);case 2:case"end":return e.stop()}}),e)})))),i.forEach(r(a().mark((function e(n,i){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.createPiece(n,t.poolPieces[1],i);case 2:case"end":return e.stop()}}),e)}))))):console.error("poolPieces is not properly initialized:",this.poolPieces)},s.createPiece=function(){var e=r(a().mark((function e(t,n,i){var o,r,s,l,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n){e.next=4;break}return console.error("Container is null or undefined. Cannot create piece."),e.abrupt("return");case 4:return e.next=6,G.getNode(C.KKPieceWidget);case 6:(s=e.sent).setParent(n),s.scale=p(.8,.8,0),s.getComponent(d).height=80,s.getComponent(d).width=80,s.name=t.type+"_"+t.color,l="r"==t.color?y.RED:y.BLACK,c=s.getComponent(M),console.log("Side: "+y[l]+", "+(null!=(o=t.realType)?o:t.type)),c.show(null!=(r=t.realType)?r:t.type,l,t),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),console.error("Error creating piece:",e.t0);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})));return function(t,n,i){return e.apply(this,arguments)}}(),s.updatePlaying=function(e){if(h.isViewer){var t=null==e?void 0:e.playerTime[h.side],n=null==e?void 0:e.playerTime[h.side==y.RED?y.BLACK:y.RED];this.lbTimes[0].string=k(t||0),this.lbTimes[1].string=k(n||0),I.instance.startGame(h.side,!0),this.spCountdown[0].startFill(e.countdown,h.side==e.currentTurn),this.spCountdown[1].startFill(e.countdown,h.side!=e.currentTurn),this.isShowEffect=!1}else{var i,o=e.players.find((function(e){return e.id==g.info.id})),r=null==e?void 0:e.playerTime[o.side],a=null==e?void 0:e.playerTime[o.side==y.RED?y.BLACK:y.RED];this.lbTimes[0].string=k(r||0),this.lbTimes[1].string=k(a||0),h.side=o.side,null==I||null==(i=I.instance)||i.startGame(o.side),this.spCountdown[0].startFill(e.countdown,o.side==e.currentTurn),this.spCountdown[1].startFill(e.countdown,o.side!=e.currentTurn),this.isShowEffect=!1}},s.updateLayer=function(){var e,t,n,i,o,r;h.otherPlayer?(this.otherPlayer.active=!0,this.otherName.string=null!=(n=h.otherPlayer.displayname)?n:h.otherPlayer.username,this.lbElo[1].string=R(null==(i=h.otherPlayer)?void 0:i.elo),null==(o=this.spCountdown[1])||o.init(null==(r=h.otherPlayer)?void 0:r.elo)):this.otherPlayer.active=!1;this.myName.string=null!=(e=g.info.displayname)?e:g.info.username,this.lbElo[0].string=R(g.getElo(!0)),null==(t=this.spCountdown[0])||t.init(g.getElo(!0)),this.checkReady()},s.checkReady=function(){var e=this;h.players.forEach((function(t){t.id==g.info.id?e.spReady[0].active=t.isReady:e.spReady[1].active=t.isReady}))},s.updateInfoPlayerForViewer=function(){var e,t,n,i,o=h.players.find((function(e){return e.side==h.side})),r=h.players.find((function(e){return e.side!=h.side}));o&&(this.myName.string=null!=(e=o.displayname)?e:o.username,this.lbElo[0].string=R(o.elo),null==(t=this.spCountdown[0])||t.init(o.elo));r?(this.otherPlayer.active=!0,this.otherName.string=null!=(n=r.displayname)?n:r.username,this.lbElo[1].string=R(r.elo),null==(i=this.spCountdown[1])||i.init(r.elo)):this.otherPlayer.active=!1;this.spReady.forEach((function(e){e.active=!1}))},s.onBtnClick=function(e,t){var n;switch(t){case"menu":E.uiMgr.showPopupAsync(b.Menu);break;case"cauhoa":L.reqAsync(N.actions,{type:A.coUp,actionID:x.peace});break;case"ready":this.controller.active=!1,L.reqAsync(N.actions,{type:A.coUp,actionID:x.readyRoom}),null==I||null==(n=I.instance)||n.resetBoard();break;case"help":E.uiMgr.showPopupAsync(w.Help);break;case"change":if(!h.fen)return void console.warn("FEN chưa sẵn sàng, bỏ qua startGame.",h.fen);h.side=h.side==y.RED?y.BLACK:y.RED,I.instance.resetBoard(),I.instance.startGame(h.side),this.updateInfoPlayerForViewer()}},s.goBackHome=function(){L.reqAsync(N.actions,{type:A.coUp,actionID:x.leaveRoom}),E.uiMgr.goLayerAsync(v.Home)},t}(f)).prototype,"otherPlayer",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$=t(X.prototype,"otherName",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ee=t(X.prototype,"myName",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),te=t(X.prototype,"controller",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ne=t(X.prototype,"waiting",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ie=t(X.prototype,"spReady",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oe=t(X.prototype,"lbTimes",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),re=t(X.prototype,"spCountdown",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ae=t(X.prototype,"poolPieces",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),se=t(X.prototype,"lbElo",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),le=t(X.prototype,"time",[Y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q=X))||Q));s._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/KKBanqiBundle', 'chunks:///_virtual/KKBanqiBundle'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});