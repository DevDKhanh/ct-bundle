System.register("chunks:///_virtual/Banqi.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,n;return{setters:[function(e){r=e.extends},function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"fb79b+/wdpOMoF+Ye2yfzLL","Banqi",void 0);e("default",(function(e){var n="b",t="r",i=-1,o="p",a="c",u="r",f="n",s="b",l="a",c="k",p="xxxxkxxxx/9/1x5x1/x1x1x1x1x/9/9/X1X1X1X1X/1X5X1/9/XXXXKXXXX r - - 0 1",h=Object.freeze(["1-0","0-1","1/2-1/2","*"]),v=Object.freeze({b:[16,-1,1],r:[-16,-1,1]}),d=Object.freeze({c:[-16,16,-1,1],r:[-16,16,-1,1],n:[-33,-31,31,33,-18,14,-14,18],b:[-34,34,30,-30],a:[-17,17,15,-15],k:[-16,16,-1,1]}),b=Object.freeze({NORMAL:"n",CAPTURE:"c"}),g=Object.freeze({NORMAL:1,CAPTURE:2}),m=Object.freeze({a9:0,b9:1,c9:2,d9:3,e9:4,f9:5,g9:6,h9:7,i9:8,a8:16,b8:17,c8:18,d8:19,e8:20,f8:21,g8:22,h8:23,i8:24,a7:32,b7:33,c7:34,d7:35,e7:36,f7:37,g7:38,h7:39,i7:40,a6:48,b6:49,c6:50,d6:51,e6:52,f6:53,g6:54,h6:55,i6:56,a5:64,b5:65,c5:66,d5:67,e5:68,f5:69,g5:70,h5:71,i5:72,a4:80,b4:81,c4:82,d4:83,e4:84,f4:85,g4:86,h4:87,i4:88,a3:96,b3:97,c3:98,d3:99,e3:100,f3:101,g3:102,h3:103,i3:104,a2:112,b2:113,c2:114,d2:115,e2:116,f2:117,g2:118,h2:119,i2:120,a1:128,b1:129,c1:130,d1:131,e1:132,f1:133,g1:134,h1:135,i1:136,a0:144,b0:145,c0:146,d0:147,e0:148,f0:149,g0:150,h0:151,i0:152}),y=[],w=[],x="",A=!1,k=Object.freeze({r:["a0","i0","a9","i9"],n:["b0","h0","b9","h9"],b:["c0","g0","c9","g9"],a:["d0","f0","d9","f9"],k:["e0","e9"],p:["a3","c3","e3","g3","i3","a6","c6","e6","g6","i6"],c:["b2","h2","b7","h7"]});function E(e){for(var r,n=0,t=0;t<x.length;++t)if("/"===(r=x.charAt(t)))n+=7;else if(fe(r))n+=parseInt(r,10);else{if(n==e)return r.toLowerCase();n++}return r.toLowerCase()}var C=function(){for(var e={},r=function(){var r=t[n],i=r[0];r[1].forEach((function(r){e[r]=i}))},n=0,t=Object.entries(k);n<t.length;n++)r();return e}(),R=new Array(256),N={r:i,b:i},T=t,_=0,q=1,O=[],j=[],P={};function I(e){void 0===e&&(e=!1),R=new Array(256),N={r:i,b:i},T=t,_=0,q=1,O=[],j=[],e||(P={}),F(z())}function L(){X(p),w=[],y=[]}function X(e,r,i){void 0===i&&(i=!1);var o=U(e);if(!o.valid)throw new Error("Invalid FEN: "+o.error);if(r){if(r&&!U(r).valid)throw new Error("Invalid random FEN provided");x=r}else x=function(){var e=["rnbakabnr","9","1c5c1","p1p1p1p1p","9","9","P1P1P1P1P","1C5C1","9","RNBAKABNR"],r=[],n=[],t={};e.forEach((function(e,i){e.split("").forEach((function(e,o){var a=i+"-"+o;"k"===e?t.black=a:"K"===e?t.red=a:e>="a"&&e<="z"?r.push(e):e>="A"&&e<="Z"&&n.push(e)}))}));var i=function(e){for(var r=e.length-1;r>0;r--){var n=Math.floor(Math.random()*(r+1)),t=[e[n],e[r]];e[r]=t[0],e[n]=t[1]}};i(r),i(n);var o=0,a=0;return e.map((function(e,i){return e.split("").map((function(e,u){var f=i+"-"+u;return f===t.black?"k":f===t.red?"K":e>="a"&&e<="z"?r[o++]:e>="A"&&e<="Z"?n[a++]:e})).join("")})).join("/")}();var a,u,f=e.split(/\s+/),s=f[0],l=0;I(i);try{for(var c=0;c<s.length;++c)"/"===(a=s.charAt(c))?l+=7:fe(a)?l+=parseInt(a,10):(u=a<"a"?t:n,B({type:a.toLowerCase(),color:u,faceType:C[ae(l)]},ae(l)),l++)}catch(e){throw new Error("Load failed: "+e.message)}return T=f[1]===n?n:t,_=parseInt(f[4],10),q=parseInt(f[5],10),F(z()),!0}function U(e){var r={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) should be '-'.",5:"3rd field (castling availability) should be '-'.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 10 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"1st field (piece positions) is invalid [each side has one king].",12:"1st field (piece positions) is invalid [each side has no more than 2 advisers].",13:"1st field (piece positions) is invalid [each side has no more than 2 bishops].",14:"1st field (piece positions) is invalid [each side has no more than 2 knights].",15:"1st field (piece positions) is invalid [each side has no more than 2 rooks].",16:"1st field (piece positions) is invalid [each side has no more than 2 cannons].",17:"1st field (piece positions) is invalid [each side has no more than 5 pawns].",18:"1st field (piece positions) is invalid [black king should at right position].",19:"1st field (piece positions) is invalid [red king should at right position].",20:"1st field (piece positions) is invalid [black adviser should at right position].",21:"1st field (piece positions) is invalid [red adviser should at right position].",22:"1st field (piece positions) is invalid [black bishop should at right position].",23:"1st field (piece positions) is invalid [red bishop should at right position].",24:"1st field (piece positions) is invalid [black pawn should at right position].",25:"1st field (piece positions) is invalid [red pawn should at right position]."};function i(e){return{valid:0===e,error_number:e,error:r[e]}}var o=e.split(/\s+/);if(6!==o.length)return i(1);if(isNaN(o[5])||parseInt(o[5],10)<=0)return i(2);if(isNaN(o[4])||parseInt(o[4],10)<0)return i(3);if(!/^-$/.test(o[3]))return i(4);if(!/^-$/.test(o[2]))return i(5);if(!/^([rwb])$/.test(o[1]))return i(6);var a=o[0].split("/");if(10!==a.length)return i(7);var u,f,s,l,p={p:{number:0,squares:[]},P:{number:0,squares:[]},c:{number:0,squares:[]},C:{number:0,squares:[]},r:{number:0,squares:[]},R:{number:0,squares:[]},n:{number:0,squares:[]},N:{number:0,squares:[]},b:{number:0,squares:[]},B:{number:0,squares:[]},a:{number:0,squares:[]},A:{number:0,squares:[]},k:{number:0,squares:[]},K:{number:0,squares:[]},x:{number:0,squares:[]},X:{number:0,squares:[]}};for(u=0;u<a.length;u++){for(s=0,l=!1,f=0;f<a[u].length;f++)if(isNaN(a[u][f])){try{++p[a[u][f]].number}catch(e){return i(9)}p[a[u][f]].squares.push(u<<4|s),s+=1,l=!1}else{if(l)return i(8);s+=parseInt(a[u][f],10),l=!0}if(9!==s)return i(10)}return 1!==p.k.number||1!==p.K.number?i(11):p.a.number>2||p.A.number>2?i(12):p.b.number>2||p.B.number>2?i(13):p.n.number>2||p.N.number>2?i(14):p.r.number>2||p.R.number>2?i(15):p.c.number>2||p.C.number>2?i(16):p.p.number>5||p.P.number>5?i(17):le(c,p.k.squares[0],n)?i(18):le(c,p.K.squares[0],t)?i(19):i(0)}function z(){for(var e,r,n=0,i="",o=m.a9;o<=m.i0;++o)null==R[o]?n++:(n>0&&(i+=n,n=0),e=R[o].color,r=R[o].type,i+=e===t?r.toUpperCase():r.toLowerCase()),oe(o)>=8&&(n>0&&(i+=n),o!==m.i0&&(i+="/"),n=0,o+=7);return[i,T,"-","-",_,q].join(" ")}function K(e){for(var r=0;r<e.length;r+=2)"string"==typeof e[r]&&"string"==typeof e[r+1]&&(P[e[r]]=e[r+1]);return P}function F(e){O.length>0||(e!==p?P.FEN=e:delete P.FEN)}function B(e,r){if(!("type"in e)||!("color"in e))throw new Error("Invalid piece object (missing type/color)");var n="x"===e.type.toLowerCase()?e.faceType:e.type;if(-1==="pcrnbakPCRNBAK".indexOf(n.toLowerCase()))throw new Error("Invalid piece type: "+e.type);if(!(r in m))throw new Error("Invalid square: "+r);var t=m[r];if(e.type===c&&N[e.color]!==i&&N[e.color]!==t)throw new Error("Invalid king placement at "+r);if("x"==e.type&&le(n,t,e.color))throw new Error("Invalid hidden piece placement at "+r);return R[t]={type:e.type,color:e.color,faceType:e.faceType},e.type===c&&(N[e.color]=t),F(z()),{ok:!0}}function $(e){var r=function(e){var r=R[m[e]];return r?{type:r.type,color:r.color,faceType:null==r?void 0:r.faceType}:null}(e);return R[m[e]]=null,r&&r.type===c&&(N[r.color]=i),F(z()),r}function M(e){function r(e,r,n,t,i){r.push(function(e,r,n,t){var i={color:T,from:r,to:n,flags:t,piece:e[r].type};return e[n]&&(i.captured=e[n].type,i.faceType=e[n].faceType),i}(e,n,t,i))}var n,i,p,h,b,y,w,x,A,k,E=[],C=T,N=ue(C),_=m.a9,q=m.i0,O=void 0===e||!("legal"in e)||e.legal,j=void 0!==e&&"opponent"in e&&e.opponent;if(void 0!==e&&"square"in e){if(!(e.square in m))return[];_=q=m[e.square]}for(j&&(T=ue(T),N=ue(C=T)),n=_;n<=q;++n)if(null!=(h=R[n])&&h.color===C){for(i=0,p=(b=(A="x"==h.type?h.faceType:h.type)===o?v[C]:d[A]).length;i<p&&(!(A===o&&i>0)||(k=n,C===t?ie(k)<5:ie(k)>4));++i)for(y=b[i],w=n,x=!1;!(se(w+=y)||A===f&&ce(n,i)||A===s&&pe(n,i)||(A===l&&"x"==h.type||h.type===c)&&le(A,w,C));){if(null==R[w]){if(A===a&&x)continue;r(R,E,n,w,g.NORMAL)}else{if(A!==a){R[w].color===N&&r(R,E,n,w,g.CAPTURE);break}if(x){R[w].color===N&&r(R,E,n,w,g.CAPTURE);break}x=!0}if(A!==a&&A!==u)break}oe(n)>=8&&(n+=7)}if(!O)return E;var P=[];for(n=0,p=E.length;n<p;n++)J(E[n]),H(C)||P.push(E[n]),re();return j&&(T=ue(T)),P}function S(e,r){return ae(e.from)+ae(e.to)}function Z(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function H(e){var r,n,t,i=N[e],p=ue(e);for(r=0,n=d.n.length;r<n;++r)if(t=i+d.n[r],null!=R[t]&&!se(t)&&R[t].color===p&&R[t].type===f&&!ce(t,r<4?3-r:11-r))return!0;for(r=0,n=d.r.length;r<n;++r){var h=d.r[r],b=!1;for(t=i+h;!se(t);t+=h){var g=R[t];if(null!=g){if(g.color===p)if(b){if(g.type===a)return!0}else if(g.type===u||g.type===c)return!0;if(b)break;b=!0}}}for(r=0,n=v[p].length;r<n;++r)if(t=i-v[p][r],null!=R[t]&&!se(t)&&R[t].color===p&&R[t].type===o)return!0;for(r=0,n=d.a.length;r<n;++r)if(t=i+d.a[r],null!=R[t]&&R[t].color===p&&R[t].type===l)return!0;for(r=0,n=d.b.length;r<n;++r)if(t=i+d.b[r],null!=R[t]&&R[t].color===p&&R[t].type===s&&!pe(i,r))return!0;return!1}function G(){return H(T)}function D(){return G()&&0===M().length}function Q(){return!G()&&0===M().length}function V(){var e,r,n={},t=0;for(var i in m)m.hasOwnProperty(i)&&(e=R[m[i]])&&(n[r="x"===e.type?e.faceType:e.type]=r in n?n[r]+1:1,t++);return 2===t||void 0===n.n&&void 0===n.r&&void 0===n.c&&void 0===n.p}function W(){for(var e={},r=0,n=w;r<n.length;r++){var t=n[r].split(" ").slice(0,2).join(" ");if(e[t]=(e[t]||0)+1,e[t]>=8)return!0}return!1}function Y(e,r){e.push({move:r,kings:{b:N.b,r:N.r},turn:T,half_moves:_,move_number:q})}function J(e){Y(O,e),null!=R[e.to]&&R[e.to].type===c&&(N[R[e.to].color]=i),R[e.to]=R[e.from],R[e.from]=null,R[e.to].type===c&&(N[R[e.to].color]=e.to),e.flags&g.CAPTURE?_=0:_++,T===n&&q++,T=ue(T)}function ee(e,r){if(void 0===r&&(r=!0),null==e)return null;var n=e.move;return N=e.kings,T=e.turn,_=e.half_moves,q=e.move_number,R[n.from]=R[n.to],R[n.from].type=n.piece,R[n.to]=null,(n.flags&g.CAPTURE)>0&&r&&(R[n.to]={type:n.captured,color:ue(T),faceType:n.faceType}),n}function re(){return ee(O.pop())}function ne(){for(var e="   +---------------------------+\n",r=m.a9;r<=m.i0;r++){if(0===oe(r)&&(e+=" "+"9876543210"[ie(r)]+" |"),null==R[r])e+=" . ";else{var n=R[r].type;e+=" "+(R[r].color===t?null==n?void 0:n.toUpperCase():null==n?void 0:n.toLowerCase())+" "}8&r&&(e+="|\n",r+=7)}return e+="   +---------------------------+\n",e+="     a  b  c  d  e  f  g  h  i\n"}function te(e,r){var n,t,i,o=Z(e),a=o.match(/([a-iA-I][0-9])-?([a-iA-I][0-9])/);r&&a&&(n=a[1],t=a[2],i=a[3]);for(var u=M(),f=0,s=u.length;f<s;f++){if(o===Z(S(u[f]))||r&&o===Z(S(u[f])))return u[f];if(a&&(!n||n.toLowerCase()===u[f].piece)&&m[t]===u[f].from&&m[i]===u[f].to)return u[f]}return null}function ie(e){return e>>4}function oe(e){return 15&e}function ae(e){var r=oe(e),n=ie(e);return"abcdefghi".substring(r,r+1)+"9876543210".substring(n,n+1)}function ue(e){return e===t?n:t}function fe(e){return-1!=="0123456789".indexOf(e)}function se(e){return e<0||ie(e)>9||oe(e)>8}function le(e,r,n){var i={};if(e===o)return i=[0,2,4,6,8],n===t?ie(r)>6||ie(r)>4&&-1===i.indexOf(oe(r)):ie(r)<3||ie(r)<5&&-1===i.indexOf(oe(r));if(e===s)i.r=[146,150,112,116,120,82,86],i.b=[2,6,32,36,40,66,70];else if(e===l)i.r=[147,149,132,115,117],i.b=[3,5,20,35,37];else{if(e!==c)return se(r);i.r=[147,148,149,131,132,133,115,116,117],i.b=[3,4,5,19,20,21,35,36,37]}return-1===i[n].indexOf(r)}function ce(e,r){return null!=R[e+[-16,16,-1,1][Math.floor(r/2)]]}function pe(e,r){return null!=R[e+[-17,17,15,-15][r]]}function he(e){var r=ve(e);r.iccs=S(r),r.to=ae(r.to),r.from=ae(r.from),r.piece=T===t?r.piece.toUpperCase():r.piece;var n="";for(var i in g)(g[i]&r.flags)>0&&(n+=b[i]);return r.flags=n,r}function ve(e){if("function"==typeof globalThis.structuredClone)return globalThis.structuredClone(e);if(null===e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map((function(e){return ve(e)}));var r={};for(var n in e)r[n]=ve(e[n]);return r}function de(e){return function(){if(A)throw new Error("Concurrent state mutation detected");try{A=!0;for(var r=arguments.length,n=new Array(r),t=0;t<r;t++)n[t]=arguments[t];return e.apply(this,n)}finally{A=!1}}}function be(e){return e.replace(/^\s+|\s+$/g,"")}function ge(e){for(var r=M({legal:!1}),n=0,t=0,i=r.length;t<i;t++){if(J(r[t]),!H(T))if(e-1>0)n+=ge(e-1);else n++;re()}return n}return X(void 0===e?p:e),{RED:t,BLACK:n,PAWN:o,CANNON:a,ROOK:u,KNIGHT:f,BISHOP:s,ADVISER:l,KING:c,SQUARES:function(){for(var e=[],r=m.a9;r<=m.i0;r++)9!==oe(r)?e.push(ae(r)):r+=6;return e}(),FLAGS:b,load:de((function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),t=1;t<r;t++)n[t-1]=arguments[t];return X.apply(void 0,[e].concat(n))})),reset:de((function(){return L()})),moves:function(e){for(var r=M(e),n=[],t=0,i=r.length;t<i;t++)void 0!==e&&"verbose"in e&&e.verbose?n.push(he(r[t])):n.push(S(r[t]));return n},in_check:function(){return G()},in_checkmate:function(){return D()},in_stalemate:function(){return Q()},in_draw:function(){return _>=120||W()||V()},insufficient_material:function(){return V()},in_threefold_repetition:function(){return W()},game_over:function(){return _>=120||D()||Q()||V()||W()||N[ue(T)]===i},validate_fen:function(e){return U(e)},fen:function(){return z()},board:function(){for(var e=[],r=[],n=m.a9;n<=m.i0;n++)null==R[n]?r.push(null):r.push({type:R[n].type,color:R[n].color,faceType:R[n].faceType}),8&n&&(e.push(r),r=[],n+=7);return ve(e)},pgn:function(e){var r,n="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",t="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,i=[],o=!1;for(r in P)i.push("["+r+' "'+P[r]+'"]'+n),o=!0;o&&O.length&&i.push(n);for(var a=[];O.length>0;)a.push(re());for(var u=[],f="";a.length>0;){var s=a.pop();O.length||"b"!==s.color?"b"!==s.color&&(f.length&&u.push(f),f=q+"."):f=q+". ...",f=f+" "+S(s),J(s)}if(f.length&&u.push(f),void 0!==P.Result&&u.push(P.Result),0===t)return i.join("")+u.join(" ");var l=0;for(r=0;r<u.length;r++)l+u[r].length>t&&0!==r?(" "===i[i.length-1]&&i.pop(),i.push(n),l=0):0!==r&&(i.push(" "),l++),i.push(u[r]),l+=u[r].length;return i.join("")},load_pgn:function(e,r){var n=void 0!==r&&"sloppy"in r&&r.sloppy;function t(e){return e.replace(/\\/g,"\\")}var i="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\r?\n",o=new RegExp("^(?:\\s)*(((?:"+t(i)+")*\\[[^\\]]+\\])+)"),a=o.test(e)?o.exec(e)[1]:"";L();var u=function(e,r){for(var n="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\r?\n",i={},o=e.split(new RegExp(t(n))),a="",u="",f=0;f<o.length;f++)a=o[f].replace(/^\[([A-Z][A-Za-z]*)\s.*]$/,"$1"),u=o[f].replace(/^\[[A-Za-z]+\s"(.*)"]$/,"$1"),be(a).length>0&&(i[a]=u);return i}(a,r);for(var f in u)u.hasOwnProperty(f)&&K([f,u[f]]);"FEN"in u&&X(u.FEN,"",!0);var s=e.replace(a,"").replace(new RegExp(t(i),"g")," ");s=s.replace(/({[^}]+})+?/g,"");for(var l=/(\([^()]+\))+?/g;l.test(s);)s=s.replace(l,"");var c=be(s=(s=(s=s.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));c=c.join(",").replace(/,,+/g,",").split(",");for(var p="",v=0;v<c.length-1;v++){if(null==(p=te(c[v],n)))return console.warn("impossible move: "+c[v]+"!\n"+ne()),!1;J(p)}if(p=c[c.length-1],h.indexOf(p)>-1)(function(e){for(var r in e)if(e.hasOwnProperty(r))return!0;return!1})(P)&&void 0===P.Result&&K(["Result",p]);else{if(null==(p=te(p,n)))return console.warn("impossible last move: "+c[c.length-1]+"!\n"+ne()),!1;J(p)}return!0},header:function(){return K(arguments)},ascii:function(){return ne()},turn:function(){return T},move:de((function(e,n){var t=function(e,n){var t=void 0!==n&&"sloppy"in n&&n.sloppy,i=null;if("string"==typeof e)i=te(e,t);else if("object"==typeof e)for(var o=M(),a=0,u=o.length;a<u;a++)if(e.from===ae(o[a].from)&&e.to===ae(o[a].to)&&!(""in o[a])){i=o[a];break}if(!i)return null;var f,s=he(i),l=R[i.from],c=R[i.to];l&&"x"==l.type&&(l.type=null!=(f=null==n?void 0:n.type)?f:E(i.from));if(c&&s.flags==b.CAPTURE){var p="x"===c.type?E(i.to):c.type;y.push(r({},c,{realType:p}))}return J(i),j=[],w.push(z()),r({},s,{piece:l.type})}(e,n);return t?ve(t):null})),undo:de((function(){Y(j,null);var e=re();if(e){var r=he(e),n=[e.to,e.from];return e.from=n[0],e.to=n[1],j[j.length-1].move=e,ve(r)}return j.pop(),null})),redo:de((function(){Y(O,null);var e=ee(j.pop(),!1);if(e){var r=[e.to,e.from];return e.from=r[0],e.to=r[1],O[O.length-1].move=e,ve(he(e))}return O.pop(),null})),clear:de((function(){return I()})),put:de((function(e,r){return B(e,r)})),remove:de((function(e){var r=$(e);return r?ve(r):r})),perft:function(e){return ge(e)},pool_capture:function(){return ve(y)},getHistory:function(){return O.map((function(e){var n=e.move;return r({},ve(n),{from:ae(n.from),to:ae(n.to),piece:n.color===t?n.piece.toUpperCase():n.piece})}))},history:function(e){var r=void 0!==e&&"verbose"in e&&e.verbose;return ve(O.map((function(e){var n=e.move;if(!r)return ae(n.from)+ae(n.to);var i={color:n.color,from:ae(n.from),to:ae(n.to),piece:n.color===t?n.piece.toUpperCase():n.piece,iccs:ae(n.from)+ae(n.to),captured:n.captured,faceType:n.faceType},o="";for(var a in g)(n.flags&g[a])>0&&(o+=b[a]);return i.flags=o,i})))}}}));n._RF.pop()}}}));

System.register("chunks:///_virtual/CoUpLogic.ts",["cc"],(function(e){var r;return{setters:[function(e){r=e.cclegacy}],execute:function(){r._RF.push({},"b5811DFqqBNtKV8QX6qmG0z","CoUpLogic",void 0);e("default",(function(e){var r="b",n="r",t=-1,i="p",o="c",u="r",s="n",a="b",f="a",l="k",p="rnbakabnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RNBAKABNR r - - 0 1",c=Object.freeze(["1-0","0-1","1/2-1/2","*"]),h=Object.freeze({b:[16,-1,1],r:[-16,-1,1]}),d=Object.freeze({c:[-16,16,-1,1],r:[-16,16,-1,1],n:[-33,-31,31,33,-18,14,-14,18],b:[-34,34,30,-30],a:[-17,17,15,-15],k:[-16,16,-1,1]}),v=Object.freeze({NORMAL:"n",CAPTURE:"c"}),g=Object.freeze({NORMAL:1,CAPTURE:2}),b=Object.freeze({a9:0,b9:1,c9:2,d9:3,e9:4,f9:5,g9:6,h9:7,i9:8,a8:16,b8:17,c8:18,d8:19,e8:20,f8:21,g8:22,h8:23,i8:24,a7:32,b7:33,c7:34,d7:35,e7:36,f7:37,g7:38,h7:39,i7:40,a6:48,b6:49,c6:50,d6:51,e6:52,f6:53,g6:54,h6:55,i6:56,a5:64,b5:65,c5:66,d5:67,e5:68,f5:69,g5:70,h5:71,i5:72,a4:80,b4:81,c4:82,d4:83,e4:84,f4:85,g4:86,h4:87,i4:88,a3:96,b3:97,c3:98,d3:99,e3:100,f3:101,g3:102,h3:103,i3:104,a2:112,b2:113,c2:114,d2:115,e2:116,f2:117,g2:118,h2:119,i2:120,a1:128,b1:129,c1:130,d1:131,e1:132,f1:133,g1:134,h1:135,i1:136,a0:144,b0:145,c0:146,d0:147,e0:148,f0:149,g0:150,h0:151,i0:152}),m=new Array(256),y={r:t,b:t},q=n,w=0,A=1,N=[],R=[],k={};function _(e){void 0===e&&(e=!1),m=new Array(256),y={r:t,b:t},q=n,w=0,A=1,N=[],R=[],e||(k={}),x(E())}function C(){O(p)}function O(e,t){if(void 0===t&&(t=!1),!P(e).valid)return!1;var i,o,u=e.split(/\s+/),s=u[0],a=0;_(t);for(var f=0;f<s.length;++f)"/"===(i=s.charAt(f))?a+=7:-1!=="0123456789".indexOf(i)?a+=parseInt(i,10):(o=i<"a"?n:r,L({type:i.toLowerCase(),color:o},J(a)),a++);return q=u[1]===r?r:n,w=parseInt(u[4],10),A=parseInt(u[5],10),x(E()),!0}function P(e){var t={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) should be '-'.",5:"3rd field (castling availability) should be '-'.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 10 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"1st field (piece positions) is invalid [each side has one king].",12:"1st field (piece positions) is invalid [each side has no more than 2 advisers].",13:"1st field (piece positions) is invalid [each side has no more than 2 bishops].",14:"1st field (piece positions) is invalid [each side has no more than 2 knights].",15:"1st field (piece positions) is invalid [each side has no more than 2 rooks].",16:"1st field (piece positions) is invalid [each side has no more than 2 cannons].",17:"1st field (piece positions) is invalid [each side has no more than 5 pawns].",18:"1st field (piece positions) is invalid [black king should at right position].",19:"1st field (piece positions) is invalid [red king should at right position].",20:"1st field (piece positions) is invalid [black adviser should at right position].",21:"1st field (piece positions) is invalid [red adviser should at right position].",22:"1st field (piece positions) is invalid [black bishop should at right position].",23:"1st field (piece positions) is invalid [red bishop should at right position].",24:"1st field (piece positions) is invalid [black pawn should at right position].",25:"1st field (piece positions) is invalid [red pawn should at right position]."};function o(e){return{valid:0===e,error_number:e,error:t[e]}}var u=e.split(/\s+/);if(6!==u.length)return o(1);if(isNaN(u[5])||parseInt(u[5],10)<=0)return o(2);if(isNaN(u[4])||parseInt(u[4],10)<0)return o(3);if(!/^-$/.test(u[3]))return o(4);if(!/^-$/.test(u[2]))return o(5);if(!/^([rwb])$/.test(u[1]))return o(6);var s=u[0].split("/");if(10!==s.length)return o(7);var p,c,h,d,v={p:{number:0,squares:[]},P:{number:0,squares:[]},c:{number:0,squares:[]},C:{number:0,squares:[]},r:{number:0,squares:[]},R:{number:0,squares:[]},n:{number:0,squares:[]},N:{number:0,squares:[]},b:{number:0,squares:[]},B:{number:0,squares:[]},a:{number:0,squares:[]},A:{number:0,squares:[]},k:{number:0,squares:[]},K:{number:0,squares:[]}};for(p=0;p<s.length;p++){for(h=0,d=!1,c=0;c<s[p].length;c++)if(isNaN(s[p][c])){try{++v[s[p][c]].number}catch(e){return o(9)}v[s[p][c]].squares.push(p<<4|h),h+=1,d=!1}else{if(d)return o(8);h+=parseInt(s[p][c],10),d=!0}if(9!==h)return o(10)}if(1!==v.k.number||1!==v.K.number)return o(11);if(v.a.number>2||v.A.number>2)return o(12);if(v.b.number>2||v.B.number>2)return o(13);if(v.n.number>2||v.N.number>2)return o(14);if(v.r.number>2||v.R.number>2)return o(15);if(v.c.number>2||v.C.number>2)return o(16);if(v.p.number>5||v.P.number>5)return o(17);if(ne(l,v.k.squares[0],r))return o(18);if(ne(l,v.K.squares[0],n))return o(19);for(p=0;p<v.a.squares.length;++p)if(ne(f,v.a.squares[p],r))return o(20);for(p=0;p<v.A.squares.length;++p)if(ne(f,v.A.squares[p],n))return o(21);for(p=0;p<v.b.squares.length;++p)if(ne(a,v.b.squares[p],r))return o(22);for(p=0;p<v.B.squares.length;++p)if(ne(a,v.B.squares[p],n))return o(23);for(p=0;p<v.p.squares.length;++p)if(ne(i,v.p.squares[p],r))return o(24);for(p=0;p<v.P.squares.length;++p)if(ne(i,v.P.squares[p],n))return o(25);return o(0)}function E(){for(var e,r,t=0,i="",o=b.a9;o<=b.i0;++o)null==m[o]?t++:(t>0&&(i+=t,t=0),e=m[o].color,r=m[o].type,i+=e===n?r.toUpperCase():r.toLowerCase()),X(o)>=8&&(t>0&&(i+=t),o!==b.i0&&(i+="/"),t=0,o+=7);return[i,q,"-","-",w,A].join(" ")}function j(e){for(var r=0;r<e.length;r+=2)"string"==typeof e[r]&&"string"==typeof e[r+1]&&(k[e[r]]=e[r+1]);return k}function x(e){N.length>0||(e!==p?k.FEN=e:delete k.FEN)}function I(e){var r=m[b[e]];return r?{type:r.type,color:r.color}:null}function L(e,r){if(!("type"in e)||!("color"in e))return!1;if(-1==="pcrnbakPCRNBAK".indexOf(e.type.toLowerCase()))return!1;if(!(r in b))return!1;var n=b[r];return(e.type!==l||y[e.color]===t||y[e.color]===n)&&(!ne(e.type,n,e.color)&&(m[n]={type:e.type,color:e.color},e.type===l&&(y[e.color]=n),x(E()),!0))}function U(e){function r(e,r,n,t,i){r.push(function(e,r,n,t){var i={color:q,from:r,to:n,flags:t,piece:e[r].type};return e[n]&&(i.captured=e[n].type),i}(e,n,t,i))}var n,t,p,c,v,y,w,A,N=[],R=q,k=Y(R),_=b.a9,C=b.i0,O=void 0===e||!("legal"in e)||e.legal,P=void 0!==e&&"opponent"in e&&e.opponent;if(void 0!==e&&"square"in e){if(!(e.square in b))return[];_=C=b[e.square]}for(P&&(q=Y(q),k=Y(R=q)),n=_;n<=C;++n)if(null!=(c=m[n])&&c.color===R){for(t=0,p=(v=c.type===i?h[R]:d[c.type]).length;t<p&&(!(c.type===i&&t>0)||ee(n,R));++t)for(y=v[t],w=n,A=!1;!(re(w+=y)||c.type===s&&te(n,t)||c.type===a&&(ie(n,t)||ee(w,R))||(c.type===f||c.type===l)&&ne(c.type,w,R));){if(null==m[w]){if(c.type===o&&A)continue;r(m,N,n,w,g.NORMAL)}else{if(c.type!==o){m[w].color===k&&r(m,N,n,w,g.CAPTURE);break}if(A){m[w].color===k&&r(m,N,n,w,g.CAPTURE);break}A=!0}if(c.type!==o&&c.type!==u)break}X(n)>=8&&(n+=7)}if(!O)return N;var E=[];for(n=0,p=N.length;n<p;n++)D(N[n]),K(R)||E.push(N[n]),H();return P&&(q=Y(q)),E}function B(e,r){return J(e.from)+J(e.to)}function F(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function K(e){var r,n,t,a=y[e],f=Y(e);for(r=0,n=d.n.length;r<n;++r)if(t=a+d.n[r],null!=m[t]&&!re(t)&&m[t].color===f&&m[t].type===s&&!te(t,r<4?3-r:11-r))return!0;for(r=0,n=d.r.length;r<n;++r){var p=d.r[r],c=!1;for(t=a+p;!re(t);t+=p){var v=m[t];if(null!=v){if(v.color===f)if(c){if(v.type===o)return!0}else if(v.type===u||v.type===l)return!0;if(c)break;c=!0}}}for(r=0,n=h[f].length;r<n;++r)if(t=a-h[f][r],null!=m[t]&&!re(t)&&m[t].color===f&&m[t].type===i)return!0;return!1}function $(){return K(q)}function z(){return $()&&0===U().length}function T(){return!$()&&0===U().length}function S(){var e,r={},n=0;for(var t in b)b.hasOwnProperty(t)&&(e=m[b[t]])&&(r[e.type]=e.type in r?r[e.type]+1:1,n++);return 2===n||void 0===r.n&&void 0===r.r&&void 0===r.c&&void 0===r.p}function G(){for(var e,r=[],n={},t=!1;e=H();)r.push(e);for(;;){var i=E().split(" ").slice(0,2).join(" ");if(n[i]=i in n?n[i]+1:1,n[i]>=3&&(t=!0),!r.length)break;D(r.pop())}return t}function M(e,r){e.push({move:r,kings:{b:y.b,r:y.r},turn:q,half_moves:w,move_number:A})}function D(e){M(N,e),null!=m[e.to]&&m[e.to].type===l&&(y[m[e.to].color]=t),m[e.to]=m[e.from],m[e.from]=null,m[e.to].type===l&&(y[m[e.to].color]=e.to),e.flags&g.CAPTURE?w=0:w++,q===r&&A++,q=Y(q)}function Z(e,r){if(void 0===r&&(r=!0),null==e)return null;var n=e.move;return y=e.kings,q=e.turn,w=e.half_moves,A=e.move_number,m[n.from]=m[n.to],m[n.from].type=n.piece,m[n.to]=null,(n.flags&g.CAPTURE)>0&&r&&(m[n.to]={type:n.captured,color:Y(q)}),n}function H(){return Z(N.pop())}function Q(){for(var e="   +---------------------------+\n",r=b.a9;r<=b.i0;r++){if(0===X(r)&&(e+=" "+"9876543210"[W(r)]+" |"),null==m[r])e+=" . ";else{var t=m[r].type;e+=" "+(m[r].color===n?t.toUpperCase():t.toLowerCase())+" "}8&r&&(e+="|\n",r+=7)}return e+="   +---------------------------+\n",e+="     a  b  c  d  e  f  g  h  i\n"}function V(e,r){var n,t,i,o=F(e),u=o.match(/([a-iA-I][0-9])-?([a-iA-I][0-9])/);r&&u&&(n=u[1],t=u[2],i=u[3]);for(var s=U(),a=0,f=s.length;a<f;a++){if(o===F(B(s[a]))||r&&o===F(B(s[a])))return s[a];if(u&&(!n||n.toLowerCase()===s[a].piece)&&b[t]===s[a].from&&b[i]===s[a].to)return s[a]}return null}function W(e){return e>>4}function X(e){return 15&e}function J(e){var r=X(e),n=W(e);return"abcdefghi".substring(r,r+1)+"9876543210".substring(n,n+1)}function Y(e){return e===n?r:n}function ee(e,r){return r===n?W(e)<5:W(e)>4}function re(e){return e<0||W(e)>9||X(e)>8}function ne(e,r,t){var o={};if(e===i)return o=[0,2,4,6,8],t===n?W(r)>6||W(r)>4&&-1===o.indexOf(X(r)):W(r)<3||W(r)<5&&-1===o.indexOf(X(r));if(e===a)o.r=[146,150,112,116,120,82,86],o.b=[2,6,32,36,40,66,70];else if(e===f)o.r=[147,149,132,115,117],o.b=[3,5,20,35,37];else{if(e!==l)return re(r);o.r=[147,148,149,131,132,133,115,116,117],o.b=[3,4,5,19,20,21,35,36,37]}return-1===o[t].indexOf(r)}function te(e,r){return null!=m[e+[-16,16,-1,1][Math.floor(r/2)]]}function ie(e,r){return null!=m[e+[-17,17,15,-15][r]]}function oe(e){var r=ue(e);r.iccs=B(r),r.to=J(r.to),r.from=J(r.from),r.piece=q===n?r.piece.toUpperCase():r.piece;var t="";for(var i in g)(g[i]&r.flags)>0&&(t+=v[i]);return r.flags=t,r}function ue(e){var r=e instanceof Array?[]:{};for(var n in e)r[n]="object"==typeof n?ue(e[n]):e[n];return r}function se(e){return e.replace(/^\s+|\s+$/g,"")}function ae(e){for(var r=U({legal:!1}),n=0,t=0,i=r.length;t<i;t++){if(D(r[t]),!K(q))if(e-1>0)n+=ae(e-1);else n++;H()}return n}return O(void 0===e?p:e),{RED:n,BLACK:r,PAWN:i,CANNON:o,ROOK:u,KNIGHT:s,BISHOP:a,ADVISER:f,KING:l,SQUARES:function(){for(var e=[],r=b.a9;r<=b.i0;r++)9!==X(r)?e.push(J(r)):r+=6;return e}(),FLAGS:v,load:function(e){return O(e)},reset:function(){return C()},moves:function(e){for(var r=U(e),n=[],t=0,i=r.length;t<i;t++)void 0!==e&&"verbose"in e&&e.verbose?n.push(oe(r[t])):n.push(B(r[t]));return n},in_check:function(){return $()},in_checkmate:function(){return z()},in_stalemate:function(){return T()},in_draw:function(){return w>=120||G()||S()},insufficient_material:function(){return S()},in_threefold_repetition:function(){return G()},game_over:function(){return w>=120||z()||T()||S()||G()||y[Y(q)]===t},validate_fen:function(e){return P(e)},fen:function(){return E()},board:function(){for(var e=[],r=[],n=b.a9;n<=b.i0;n++)null==m[n]?r.push(null):r.push({type:m[n].type,color:m[n].color}),8&n&&(e.push(r),r=[],n+=7);return e},pgn:function(e){var r,n="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",t="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,i=[],o=!1;for(r in k)i.push("["+r+' "'+k[r]+'"]'+n),o=!0;o&&N.length&&i.push(n);for(var u=[];N.length>0;)u.push(H());for(var s=[],a="";u.length>0;){var f=u.pop();N.length||"b"!==f.color?"b"!==f.color&&(a.length&&s.push(a),a=A+"."):a=A+". ...",a=a+" "+B(f),D(f)}if(a.length&&s.push(a),void 0!==k.Result&&s.push(k.Result),0===t)return i.join("")+s.join(" ");var l=0;for(r=0;r<s.length;r++)l+s[r].length>t&&0!==r?(" "===i[i.length-1]&&i.pop(),i.push(n),l=0):0!==r&&(i.push(" "),l++),i.push(s[r]),l+=s[r].length;return i.join("")},load_pgn:function(e,r){var n=void 0!==r&&"sloppy"in r&&r.sloppy;function t(e){return e.replace(/\\/g,"\\")}var i="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\r?\n",o=new RegExp("^(?:\\s)*(((?:"+t(i)+")*\\[[^\\]]+\\])+)"),u=o.test(e)?o.exec(e)[1]:"";C();var s=function(e,r){for(var n="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\r?\n",i={},o=e.split(new RegExp(t(n))),u="",s="",a=0;a<o.length;a++)u=o[a].replace(/^\[([A-Z][A-Za-z]*)\s.*]$/,"$1"),s=o[a].replace(/^\[[A-Za-z]+\s"(.*)"]$/,"$1"),se(u).length>0&&(i[u]=s);return i}(u,r);for(var a in s)s.hasOwnProperty(a)&&j([a,s[a]]);if("FEN"in s&&!O(s.FEN,!0))return console.warn("load header FEN failed!"),!1;var f=e.replace(u,"").replace(new RegExp(t(i),"g")," ");f=f.replace(/({[^}]+})+?/g,"");for(var l=/(\([^()]+\))+?/g;l.test(f);)f=f.replace(l,"");var p=se(f=(f=(f=f.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));p=p.join(",").replace(/,,+/g,",").split(",");for(var h="",d=0;d<p.length-1;d++){if(null==(h=V(p[d],n)))return console.warn("impossible move: "+p[d]+"!\n"+Q()),!1;D(h)}if(h=p[p.length-1],c.indexOf(h)>-1)(function(e){for(var r in e)if(e.hasOwnProperty(r))return!0;return!1})(k)&&void 0===k.Result&&j(["Result",h]);else{if(null==(h=V(h,n)))return console.warn("impossible last move: "+p[p.length-1]+"!\n"+Q()),!1;D(h)}return!0},header:function(){return j(arguments)},ascii:function(){return Q()},turn:function(){return q},move:function(e,r){var n=void 0!==r&&"sloppy"in r&&r.sloppy,t=null;if("string"==typeof e)t=V(e,n);else if("object"==typeof e)for(var i=U(),o=0,u=i.length;o<u;o++)if(e.from===J(i[o].from)&&e.to===J(i[o].to)&&!(""in i[o])){t=i[o];break}if(!t)return null;var s=oe(t);return D(t),R=[],s},undo:function(){M(R,null);var e=H();if(e){var r=oe(e),n=[e.to,e.from];return e.from=n[0],e.to=n[1],R[R.length-1].move=e,r}return R.pop(),null},redo:function(){M(N,null);var e=Z(R.pop(),!1);if(e){var r=[e.to,e.from];return e.from=r[0],e.to=r[1],N[N.length-1].move=e,oe(e)}return N.pop(),null},clear:function(){return _()},put:function(e,r){return L(e,r)},get:function(e){return I(e)},remove:function(e){return function(e){var r=I(e);return m[b[e]]=null,r&&r.type===l&&(y[r.color]=t),x(E()),r}(e)},perft:function(e){return ae(e)},history:function(e){for(var r=[],n=[],t=(void 0!==e&&"verbose"in e&&e.verbose);N.length>0;)r.push(H());for(;r.length>0;){var i=r.pop();t?n.push(oe(i)):n.push(B(i)),D(i)}return n}}}));r._RF.pop()}}}));

System.register("chunks:///_virtual/GameManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIBase.ts","./KKTileCoTuongWidget.ts","./KKPieceWidget.ts","./kk.ts","./GameCoTuongData.ts","./SocketIO.ts","./SocketEvent.ts","./Xiangqi.ts","./MessageEvent.ts","./AudioPath.ts","./Banqi.ts"],(function(e){var i,t,n,o,r,a,c,s,l,u,h,f,d,g,v,p,P,b,m,y,T,w,A,C,q,M,k,x,_,I;return{setters:[function(e){i=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,o=e.assertThisInitialized,r=e.createClass,a=e.asyncToGenerator,c=e.regeneratorRuntime},function(e){s=e.cclegacy,l=e._decorator,u=e.Node,h=e.Prefab,f=e.sp,d=e.NodePool,g=e.instantiate},function(e){v=e.UIBase},function(e){p=e.KKTileCoTuongWidget},function(e){P=e.KKPieceWidget,b=e.Side,m=e.PieceType},function(e){y=e.default},function(e){T=e.default},function(e){w=e.default},function(e){A=e.SocketEvent,C=e.typeSocket,q=e.actionID},function(e){M=e.default},function(e){k=e.MessageEventType},function(e){x=e.randomSound,_=e.AudioPath},function(e){I=e.default}],execute:function(){var E,D,S,B,K,L,z,H,F,O,R,G,U,N,Q,W,j,V,Y,X;s._RF.push({},"c6e4c6GH8VGhrliUjszojDw","GameManager",void 0);var $=l.ccclass,J=l.property;e("GameManager",(E=$("GameManager"),D=J(u),S=J([h]),B=J(h),K=J(h),L=J(f.Skeleton),z=J(f.Skeleton),H=J(f.Skeleton),F=J(P),E(((X=function(e){function i(){for(var i,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r))||this,n(i,"container",G,o(i)),n(i,"piecePrefabs",U,o(i)),n(i,"piecePrefab",N,o(i)),n(i,"tilePrefab",Q,o(i)),n(i,"chieuTuong",W,o(i)),n(i,"batDau",j,o(i)),n(i,"anQuan",V,o(i)),i.xiangqi=null,i.isBanqi=!1,n(i,"selectedPiece",Y,o(i)),i.board=[],i.isPlay=!1,i.isCanReload=!1,i.piecePool=new d,i.tilePool=new d,i.pieceManager=[],i}t(i,e);var s=i.prototype;return s.initGame=function(e){e?(this.isBanqi=!0,this.xiangqi=I()):this.xiangqi=M()},s.putToPiecePool=function(e){this.piecePool.put(e)},s.getBoard=function(){return this.board},s.onLoad=function(){var e=this;y.eventMgr.on(k.ON_SELECT_TILE,this.onSelectPiece,this),y.eventMgr.on(k.ON_MOVE_PIECE,this.onMove,this),y.eventMgr.on(k.PUT_TO_POOL,this.putToPiecePool,this),y.eventMgr.on(k.SHOW_HISTORY,this.showHistory,this),w.on(A.makeMove,(function(i){i&&(console.log("Nhận dữ liệu di chuyển từ server:",i),e.movePieceToTile(i),T.fen=null==i?void 0:i.fen),e.selectedPiece&&(e.selectedPiece.unActive(),e.selectedPiece=null)})),i._instance||(i._instance=this),this.initPiecePool(32),this.initTilePool(90)},s.onDestroy=function(){i._instance=null,e.prototype.onDestroy.call(this),w.off(A.makeMove),y.eventMgr.offTargetAll(this),this.piecePool.clear(),this.tilePool.clear()},s.initPiecePool=function(e){for(var i=0;i<e;i++){var t=g(this.piecePrefab);this.piecePool.put(t)}},s.initTilePool=function(e){for(var i=0;i<e;i++){var t=g(this.tilePrefab);this.tilePool.put(t)}},s.createBoard=function(e){void 0===e&&(e=b.RED),this.xiangqi.load(T.fen),this.board=[];for(var i=0;i<10;i++){for(var t=[],n=0;n<9;n++){var o=void 0;o=this.tilePool.size()>0?this.tilePool.get():g(this.tilePrefab);var r=void 0,a=void 0;e===b.BLACK?(r=116*(8-n)-484+20,a=116*(9-i)-527):(r=116*n-484+20,a=116*i-527),o.setPosition(r,a);var c=o.getComponent(p);c&&c.init(i,n),o.name=i+"_"+n,this.container.addChild(o),t.push(o)}this.board.push(t)}console.log("CREATE BOARD")},s.setupPieces=function(){var e,i=null==(e=this.xiangqi)?void 0:e.board();if(i)for(var t=0;t<i.length;t++)for(var n=0;n<i[t].length;n++){var o=i[t][n];if(null!==o){var r=o.type,a="r"===o.color?b.RED:b.BLACK,c=9-t,s=n;this.placePiece(r,a,c,s)}}},s.placePiece=function(e,i,t,n){var o,r=(o=this.piecePool.size()>0?this.piecePool.get():g(this.piecePrefab)).getComponent(P);r&&(r.name=m[e]+"_"+b[i],r.init(t,n,e,i),r.unActive(),this.board[t]&&this.board[t][n]?this.board[t][n].addChild(o):console.error("Board index lỗi: row "+t+", col "+n),this.pieceManager.push(r))},s.resetBoard=function(){if(this.isPlay){this.isPlay=!1,this.selectedPiece=null,this.pieceManager=[];for(var e=0;e<this.board.length;e++)for(var i=0;i<this.board[e].length;i++){var t=this.board[e][i];if(t){var n=t.getComponentInChildren(P);n&&(n.node.removeFromParent(),this.piecePool.put(n.node));var o=t.getComponent(p);o&&(o.hide(),o.hideHistory()),t.removeFromParent(),this.tilePool.put(t)}}this.board=[]}},s.onSelectPiece=function(e){var i,t,n,o=this;if(y.eventMgr.emit(k.HIDE_TILE),!e)return console.warn("Quân cờ không tồn tại"),void(null==(t=this.selectedPiece)||t.unActive());if(T.side!==this.currentTurn)return console.log("Không thể chọn quân cờ: không đúng lượt"),void(null==(n=this.selectedPiece)||n.unActive());if(this.selectedPiece&&this.selectedPiece.side!==e.side)console.log("Không thể chọn quân cờ của đối phương");else{var r;if(this.currentTurn!==e.side||this.selectedPiece===e)return console.log("Không phải lượt của bạn",e,this.currentTurn),null==(r=this.selectedPiece)||r.unActive(),void(this.selectedPiece=null);var a,c=this.convertToAscii(e.row,e.col);try{a=this.xiangqi?this.xiangqi.moves({square:c,verbose:!0}):[]}catch(e){return void console.error("Lỗi tính toán nước đi:",e)}null==(i=this.selectedPiece)||i.unActive(),this.selectedPiece=e,this.selectedPiece.active(),console.log("Chọn quân cờ:",e.name,"với nước đi:",c,a),a.forEach((function(i){var t=o.convertFromAscii(i.to),n=t.row,r=t.col,a=o.board[n]&&o.board[n][r]?o.board[n][r].getComponent(p):null;if(a){var c=o.board[n][r].getComponentInChildren(P);c&&c.side!==e.side&&(a.activeAttack(),a.node.setSiblingIndex(100)),a.active()}}))}},s.startGame=function(e,i){this.isPlay||(i&&(this.batDau.node.active=!0,this.batDau.setAnimation(0,"animation",!1),x(_.effect,"giaophong",!0,!1),x(_.effect,"start",!0,!1)),this.isPlay=!0,this.board=[],this.createBoard(e),this.setupPieces())},s.onMove=function(e){if(this.selectedPiece&&(e.pos.col!==this.selectedPiece.col||e.pos.row!==this.selectedPiece.row)){var i=""+this.convertToAscii(this.selectedPiece.row,this.selectedPiece.col)+this.convertToAscii(e.pos.row,e.pos.col);w.reqAsync(A.actions,{type:this.isBanqi?C.coUp:C.coTuong,actionID:q.makeMove,roomId:T.id,move:i})}},s.movePieceToTile=function(e){if(e){var i,t=this.convertFromAscii(e.from),n=this.convertFromAscii(e.to);try{i=!!this.xiangqi&&this.xiangqi.move(""+e.from+e.to,{type:null==e?void 0:e.piece})}catch(e){return void console.error("Lỗi di chuyển từ server:",e)}if(i){"c"!==e.flags||this.xiangqi.in_check()||(this.anQuan.node.active=!0,this.anQuan.setAnimation(0,"animation",!1),x(_.effect,"anquan",!0,!1));var o=this.board[t.row]?this.board[t.row][t.col]:null;if(o){var r=o.getComponentInChildren(P),a=this.board[n.row]?this.board[n.row][n.col]:null;r&&a&&(this.movePiece(r,a.getComponent(p)),this.isBanqi&&r.show(e.piece))}}else console.log("Không thể di chuyển")}},s.movePiece=function(){var e=a(c().mark((function e(i,t){var n,o,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i&&t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,i.onMovePiece(t);case 4:try{n=!!this.xiangqi&&this.xiangqi.in_check(),o=!!this.xiangqi&&this.xiangqi.in_draw(),r=!!this.xiangqi&&this.xiangqi.game_over(),o?console.log("Hòa"):n&&(this.chieuTuong.node.active=!0,r?(this.chieuTuong.setAnimation(0,"chieubi",!1),x(_.effect,"chieubi",!0,!1)):(this.chieuTuong.setAnimation(0,"chieutuong",!1),x(_.effect,"chieu",!0,!1)))}catch(e){console.error("Lỗi khi kiểm tra trạng thái game:",e)}case 5:case"end":return e.stop()}}),e,this)})));return function(i,t){return e.apply(this,arguments)}}(),s.showHistory=function(){var e;y.eventMgr.emit(k.HIDE_TILE_HISTORY);var i=null==(e=this.xiangqi)?void 0:e.getHistory();if(this.xiangqi&&!(i.length<=0)){var t=i.pop();if(t){var n=this.convertFromAscii(t.from),o=this.convertFromAscii(t.to),r=this.board[n.row]?this.board[n.row][n.col]:null,a=this.board[o.row]?this.board[o.row][o.col]:null;if(r&&a){var c=r.getComponent(p),s=a.getComponent(p);c&&c.showFrom(),s&&s.showTo()}}}},s.getPiece=function(e,i){return this.pieceManager.find((function(t){return t.type===e&&t.side===i}))},s.convertToAscii=function(e,i){return(""+String.fromCharCode(65+i)+e).toLowerCase()},s.convertFromAscii=function(e){var i=e.toUpperCase().match(/^([A-I])(\d)$/);if(!i)return console.error("Định dạng ASCII không hợp lệ: "+e),{row:-1,col:-1};var t=i[1],n=i[2],o=t.charCodeAt(0)-65;return{row:parseInt(n),col:o}},s.isMyTurn=function(){return T.side==this.currentTurn},r(i,[{key:"currentTurn",get:function(){return"r"===this.xiangqi.turn()?b.RED:b.BLACK}}],[{key:"instance",get:function(){return this._instance}}]),i}(v))._instance=null,G=i((R=X).prototype,"container",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=i(R.prototype,"piecePrefabs",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),N=i(R.prototype,"piecePrefab",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q=i(R.prototype,"tilePrefab",[K],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),W=i(R.prototype,"chieuTuong",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j=i(R.prototype,"batDau",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=i(R.prototype,"anQuan",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y=i(R.prototype,"selectedPiece",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O=R))||O));s._RF.pop()}}}));

System.register("chunks:///_virtual/KKBanCoPanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIBase.ts","./GameManager.ts"],(function(n){var e,t,a,o,i;return{setters:[function(n){e=n.inheritsLoose},function(n){t=n.cclegacy,a=n._decorator},function(n){o=n.UIBase},function(n){i=n.GameManager}],execute:function(){var r;t._RF.push({},"e5e62OVw9NKtZEJwIwAZj9H","KKBanCoPanel",void 0);var c=a.ccclass;a.property,n("KKBanCoPanel",c("KKBanCoPanel")(r=function(n){function t(){return n.apply(this,arguments)||this}e(t,n);var a=t.prototype;return a.onEnable=function(){var n;i.instance.initGame(null==(n=this.recvData)?void 0:n.isBanqi)},a.onBtnClick=function(n,e){},t}(o))||r);t._RF.pop()}}}));

System.register("chunks:///_virtual/KKCauHoaPopup.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PopupBase.ts","./SocketEvent.ts","./SocketIO.ts","./GameManager.ts"],(function(o){var t,n,e,c,a,s,u,i,p;return{setters:[function(o){t=o.inheritsLoose},function(o){n=o.cclegacy,e=o._decorator},function(o){c=o.PopupBase},function(o){a=o.typeSocket,s=o.SocketEvent,u=o.actionID},function(o){i=o.default},function(o){p=o.GameManager}],execute:function(){var r;n._RF.push({},"d8931MLgOhOgJ07RHEmi8Vh","KKCauHoaPopup",void 0);var f=e.ccclass;e.property,o("KKCauHoaPopup",f("KKCauHoaPopup")(r=function(o){function n(){return o.apply(this,arguments)||this}return t(n,o),n.prototype.onBtnClick=function(o,t){var n=p.instance.isBanqi?a.coUp:a.coTuong;switch(t){case"ok":case"no":i.reqAsync(s.actions,{type:n,actionID:u.peaceAnswer,isOk:"ok"==t}),this.close()}},n}(c))||r);n._RF.pop()}}}));

System.register("chunks:///_virtual/KKCoTuongBundle",["./Banqi.ts","./CoUpLogic.ts","./GameManager.ts","./KKBanCoPanel.ts","./KKCauHoaPopup.ts","./KKCoTuongLayer.ts","./KKEndGamePopup.ts","./KKMenuPopup.ts","./KKPieceWidget.ts","./KKTileCoTuongWidget.ts","./Xiangqi.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/KKCoTuongLayer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LayerBase.ts","./kk.ts","./KKGameUIConf.ts","./SocketIO.ts","./SocketEvent.ts","./GameCoTuongData.ts","./GameData.ts","./SpriteNumber.ts","./CocosHelper.ts","./GameManager.ts","./KKEndGamePopup.ts","./KKUtils.ts","./KKAvatarWidget.ts","./AsyncHelper.ts","./LabelEllipsis.ts"],(function(e){var t,n,i,r,a,o,s,l,u,c,p,d,f,h,y,m,b,w,g,v,T,C,P,E,k,K,R,D,L,A,N,x,I;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,a=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){s=e.cclegacy,l=e._decorator,u=e.Node,c=e.Label},function(e){p=e.LayerBase},function(e){d=e.default},function(e){f=e.KKCoTuongPopupConf,h=e.KKLayerConf,y=e.KKCoTuongPanelConf,m=e.KKHomePopupConf},function(e){b=e.default},function(e){w=e.SocketEvent,g=e.typeSocket,v=e.actionID},function(e){T=e.default,C=e.Side,P=e.RoomStatus},function(e){E=e.default},function(e){k=e.SpriteNumber},function(e){K=e.secondsToMinute,R=e.coin},function(e){D=e.GameManager},function(e){L=e.EFFECT},function(e){A=e.default},function(e){N=e.KKAvatarWidget},function(e){x=e.default},function(e){I=e.EllipsisLabel}],execute:function(){var G,O,M,F,S,B,z,V,H,W,j,q,U,_,Y,Z,J,Q,X,$,ee,te,ne;s._RF.push({},"3c0e2tHY49ARKWZ03Oj047/","KKCoTuongLayer",void 0);var ie=l.ccclass,re=l.property;e("KKCoTuongLayer",(G=ie("KKCoTuongLayer"),O=re(u),M=re(I),F=re(I),S=re(u),B=re(u),z=re({type:[u],displayName:"Ảnh chữ sẵn sàng",tooltip:"[0] => Me; [1] => Other Player"}),V=re({type:[c],displayName:"Lable hiển thị thời gian",tooltip:"[0] => Me; [1] => Other Player"}),H=re({type:[c],displayName:"Lable hiển thị elo",tooltip:"[0] => Me; [1] => Other Player"}),W=re({type:[N],displayName:"Sprite hiển thị thời gian",tooltip:"[0] => Me; [1] => Other Player"}),j=re(k),G((_=t((U=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,i(t,"otherPlayer",_,r(t)),i(t,"otherName",Y,r(t)),i(t,"myName",Z,r(t)),i(t,"controller",J,r(t)),i(t,"waiting",Q,r(t)),i(t,"spReady",X,r(t)),i(t,"lbTimes",$,r(t)),i(t,"lbElo",ee,r(t)),i(t,"spCountdown",te,r(t)),i(t,"time",ne,r(t)),t.isShowEffect=!1,t}n(t,e);var s=t.prototype;return s.onLoad=function(){var e,t;this.time=this.getObj("controller.time",k),T.isLeaveRoom=!1,T.isViewer=null==(e=this.recvData)?void 0:e.isViewer,T.id=null==(t=this.recvData)?void 0:t.roomID},s.start=function(){var e=a(o().mark((function e(){var t,n,i,r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T.isViewer||(b.on(w.peace,(function(){d.uiMgr.showPopupAsync(f.CauHoa)})),b.on(w.messageCoTuong,(function(e){A.showToast(e)})),b.on(w.peaceAnswer,(function(){r.showEnd(L.hoa),r.spCountdown[0].startFill(0,!1),r.spCountdown[1].startFill(0,!1)}))),b.on(w.startGame,(function(){var e;null==D||null==(e=D.instance)||e.resetBoard()})),b.reqAsync(w.actions,{type:g.coTuong,actionID:v.joinRoom,roomID:null==(t=this.recvData)?void 0:t.roomID}),b.on(w.dataRoom,a(o().mark((function e(t){var n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.id!=T.id&&null!=T&&T.id||T.isLeaveRoom)){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,!t){e.next=23;break}if(r.waiting.active=t.status==P.WAITING&&!T.isViewer,t.fen&&(T.fen=t.fen),T.isViewer){e.next=21;break}if(null!=t&&null!=(n=t.players)&&n.some((function(e){return(null==e?void 0:e.id)==E.info.id}))?(T.setData(t),r.updateLayer()):(T.leaveRoom(),r.goBackHome()),null==t||!t.loser){e.next=19;break}if(i=t.loser.id==E.info.id,!d.uiMgr.getPopup(f.EndGame)&&!r.isShowEffect){e.next=13;break}return e.abrupt("return");case 13:return r.isShowEffect=!0,e.next=16,x.sleepAsync(.8);case 16:i?r.showEnd(L.thua):r.showEnd(L.thang),r.spCountdown[0].startFill(0,!1),r.spCountdown[1].startFill(0,!1);case 19:e.next=23;break;case 21:T.setData(t),r.updateInfoPlayerForViewer();case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(2),T.leaveRoom(),r.goBackHome();case 29:case"end":return e.stop()}}),e,null,[[2,25]])})))),b.on(w.countDown,a(o().mark((function e(t){var n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id==T.id||null==T||!T.id){e.next=2;break}return e.abrupt("return");case 2:i=null==t||null==(n=t.players)?void 0:n.find((function(e){return e.isReady&&e.id==E.info.id})),r.time&&(r.time.value=t.countdown),T.isViewer||(t.status!=P.COUNTDOWN?r.controller.active=!1:r.controller.active=!i),t.status==P.PLAYING?r.updatePlaying(t):t.status!=P.COUNTDOWN&&t.status!=P.WAITING||(r.waiting.active=t.status==P.WAITING);case 6:case"end":return e.stop()}}),e)})))),n=this.getObj("ban"),e.next=8,d.uiMgr.createPanelAsync(y.BanCo);case 8:i=e.sent,n.addChild(i),this.getObj("menu.btn-hoa").active=!T.isViewer,this.getObj("menu.btn-doi").active=T.isViewer;case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),s.onDestroy=function(){b.off(w.dataRoom),b.off(w.peace),b.off(w.peaceAnswer),b.off(w.countDown),b.off(w.messageCoTuong),b.off(w.startGame)},s.showEnd=function(e){var t,n,i,r;d.uiMgr.showPopupAsync(f.EndGame,{effect:e,name:null!=(t=null==(n=T.cloneOtherPlayer)?void 0:n.displayname)?t:null==(i=T.cloneOtherPlayer)?void 0:i.username,elo:null==(r=T.cloneOtherPlayer)?void 0:r.elo})},s.updatePlaying=function(e){if(T.isViewer){var t=null==e?void 0:e.playerTime[T.side],n=null==e?void 0:e.playerTime[T.side==C.RED?C.BLACK:C.RED];this.lbTimes[0].string=K(t||0),this.lbTimes[1].string=K(n||0),D.instance.startGame(T.side,!0),this.spCountdown[0].startFill(e.countdown,T.side==e.currentTurn),this.spCountdown[1].startFill(e.countdown,T.side!=e.currentTurn),this.isShowEffect=!1}else{var i=e.players.find((function(e){return e.id==E.info.id})),r=null==e?void 0:e.playerTime[i.side],a=null==e?void 0:e.playerTime[i.side==C.RED?C.BLACK:C.RED];this.lbTimes[0].string=K(r||0),this.lbTimes[1].string=K(a||0),T.side=i.side,D.instance.startGame(i.side,!0),this.spCountdown[0].startFill(e.countdown,i.side==e.currentTurn),this.spCountdown[1].startFill(e.countdown,i.side!=e.currentTurn),this.isShowEffect=!1}},s.updateInfoPlayerForViewer=function(){var e,t,n,i,r=T.players.find((function(e){return e.side==T.side})),a=T.players.find((function(e){return e.side!=T.side}));r&&(this.myName.setLabelText(null!=(e=r.displayname)?e:r.username),this.lbElo[0].string=R(r.elo),null==(t=this.spCountdown[0])||t.init(r.elo));a?(this.otherPlayer.active=!0,this.otherName.setLabelText(null!=(n=a.displayname)?n:a.username),this.lbElo[1].string=R(a.elo),null==(i=this.spCountdown[1])||i.init(a.elo)):this.otherPlayer.active=!1;this.spReady.forEach((function(e){e.active=!1}))},s.updateLayer=function(){var e,t,n,i,r,a;T.otherPlayer?(this.otherPlayer.active=!0,this.otherName.setLabelText(null!=(n=T.otherPlayer.displayname)?n:T.otherPlayer.username),this.lbElo[1].string=R(null==(i=T.otherPlayer)?void 0:i.elo),null==(r=this.spCountdown[1])||r.init(null==(a=T.otherPlayer)?void 0:a.elo)):this.otherPlayer.active=!1;this.myName.setLabelText(null!=(e=E.info.displayName)?e:E.info.username),this.lbElo[0].string=R(E.getElo()),null==(t=this.spCountdown[0])||t.init(E.getElo()),this.checkReady()},s.checkReady=function(){var e=this;T.players.forEach((function(t){t.id==E.info.id?e.spReady[0].active=t.isReady:e.spReady[1].active=t.isReady}))},s.onBtnClick=function(){var e=a(o().mark((function e(t,n){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=n,e.next="menu"===e.t0?3:"change"===e.t0?6:"cauhoa"===e.t0?11:"ready"===e.t0?13:"help"===e.t0?16:18;break;case 3:return e.next=5,d.uiMgr.showPopupAsync(f.Menu);case 5:return e.abrupt("break",18);case 6:return T.side=T.side==C.RED?C.BLACK:C.RED,D.instance.resetBoard(),D.instance.startGame(T.side),this.updateInfoPlayerForViewer(),e.abrupt("break",18);case 11:return b.reqAsync(w.actions,{type:g.coTuong,actionID:v.peace}),e.abrupt("break",18);case 13:return this.controller.active=!1,b.reqAsync(w.actions,{type:g.coTuong,actionID:v.readyRoom}),e.abrupt("break",18);case 16:return d.uiMgr.showPopupAsync(m.Help),e.abrupt("break",18);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),s.goBackHome=function(){b.reqAsync(w.actions,{type:g.coTuong,actionID:v.leaveRoom}),d.uiMgr.goLayerAsync(h.Home)},t}(p)).prototype,"otherPlayer",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y=t(U.prototype,"otherName",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z=t(U.prototype,"myName",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J=t(U.prototype,"controller",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q=t(U.prototype,"waiting",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X=t(U.prototype,"spReady",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$=t(U.prototype,"lbTimes",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ee=t(U.prototype,"lbElo",[H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),te=t(U.prototype,"spCountdown",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ne=t(U.prototype,"time",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q=U))||q));s._RF.pop()}}}));

System.register("chunks:///_virtual/KKEndGamePopup.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PopupBase.ts","./KKAvatarWidget.ts","./GameData.ts","./AudioPath.ts"],(function(e){var t,n,i,a,o,r,l,u,c,s,f,h,p,m;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){o=e.cclegacy,r=e._decorator,l=e.sp,u=e.Label,c=e.Color},function(e){s=e.PopupBase},function(e){f=e.KKAvatarWidget},function(e){h=e.default},function(e){p=e.randomSound,m=e.AudioPath}],execute:function(){var d,g,v,y,b,E,K,D,P,A,w,z,L;o._RF.push({},"31c1cUP4alArZNs2lRhilTf","KKEndGamePopup",void 0);var N=e("EFFECT",function(e){return e.hoa="hoa",e.thang="thang",e.thua="thua",e}({})),T=r.ccclass,G=r.property;e("KKEndGamePopup",(d=T("KKEndGamePopup"),g=G(l.Skeleton),v=G(f),y=G(u),b=G(u),E=G(u),d((P=t((D=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return t=e.call.apply(e,[this].concat(o))||this,i(t,"effect",P,a(t)),i(t,"otherAvatar",A,a(t)),i(t,"myName",w,a(t)),i(t,"otherName",z,a(t)),i(t,"elo",L,a(t)),t.timer=null,t}n(t,e);var o=t.prototype;return o.onLoad=function(){var e,t,n,i=this;void 0!==h.changedElo&&(this.recvData.effect==N.thang?p(m.effect,"win",!0,!1):this.recvData.effect==N.thua?p(m.effect,"lose",!0,!1):p(m.effect,"draw",!0,!1),this.effect.setAnimation(0,this.recvData.effect,!1),this.enableClickBlankToClose(),this.timer=setTimeout((function(){i.close()}),3700),this.myName.string=null!=(e=h.info.displayname)?e:h.info.username,this.otherName.string=null==(t=this.recvData)?void 0:t.name,this.otherAvatar.init(null==(n=this.recvData)?void 0:n.elo),this.elo.string="ELO: "+(h.changedElo>=0?"+"+h.changedElo:h.changedElo),this.elo.color=h.changedElo>0?c.YELLOW:c.WHITE)},o.onDestroy=function(){clearTimeout(this.timer),e.prototype.onDestroy.call(this)},t}(s)).prototype,"effect",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=t(D.prototype,"otherAvatar",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(D.prototype,"myName",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(D.prototype,"otherName",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(D.prototype,"elo",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K=D))||K));o._RF.pop()}}}));

System.register("chunks:///_virtual/KKMenuPopup.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PopupBase.ts","./kk.ts","./KKGameUIConf.ts","./SocketEvent.ts","./SocketIO.ts","./GameCoTuongData.ts","./GameManager.ts"],(function(e){var t,n,o,a,c,s,i,u,r,p,l,f;return{setters:[function(e){t=e.inheritsLoose},function(e){n=e.cclegacy,o=e._decorator},function(e){a=e.PopupBase},function(e){c=e.default},function(e){s=e.KKLayerConf},function(e){i=e.typeSocket,u=e.SocketEvent,r=e.actionID},function(e){p=e.default},function(e){l=e.default},function(e){f=e.GameManager}],execute:function(){var h;n._RF.push({},"1eb514UINlNr7RQndgpfvOM","KKMenuPopup",void 0);var g=o.ccclass;o.property,e("KKMenuPopup",g("KKMenuPopup")(h=function(e){function n(){return e.apply(this,arguments)||this}t(n,e);var o=n.prototype;return o.onLoad=function(){this.enableClickBlankToClose()},o.start=function(){this.getObj("khung.menu.cau-hoa").active=!l.isViewer,this.getObj("khung.menu.xin-thua").active=!l.isViewer},o.onBtnClick=function(e,t){var n=f.instance.isBanqi?i.coUp:i.coTuong;switch(t){case"dong":this.close();break;case"thoat":p.reqAsync(u.actions,{type:n,actionID:r.leaveRoom}),l.leaveRoom(),c.uiMgr.goLayerAsync(s.Home);break;case"cauhoa":p.reqAsync(u.actions,{type:n,actionID:r.peace}),this.close();break;case"xinthua":p.reqAsync(u.actions,{type:n,actionID:r.surrender}),this.close();break;case"tatieng":case"tatnhac":this.close()}},n}(a))||h);n._RF.pop()}}}));

System.register("chunks:///_virtual/KKPieceWidget.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIBase.ts","./AudioPath.ts","./SkinManager.ts","./kk.ts","./MessageEvent.ts"],(function(e){var t,n,i,r,o,s,a,u,c,l,p,d,f,h,g,y,b,v,m,T,O;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized,o=e.asyncToGenerator,s=e.regeneratorRuntime},function(e){a=e.cclegacy,u=e._decorator,c=e.Enum,l=e.Sprite,p=e.Label,d=e.Color,f=e.tween,h=e.Vec3,g=e.UITransform},function(e){y=e.UIBase},function(e){b=e.randomSound,v=e.AudioPath},function(e){m=e.GameType},function(e){T=e.default},function(e){O=e.MessageEventType}],execute:function(){var w,P,E,N,S,A,C,I,k,K,D,R,M;a._RF.push({},"16e85RIKa5Dd7QtgUCAiYFj","KKPieceWidget",void 0);var U=u.ccclass,W=u.property,z=e("PieceType",function(e){return e.TUONG="k",e.SI="a",e.TINH="b",e.XE="r",e.PHAO="c",e.MA="n",e.TOT="p",e.NONE="x",e}({})),L=e("Side",function(e){return e[e.RED=0]="RED",e[e.BLACK=1]="BLACK",e}({}));e("KKPieceWidget",(w=U("KKPieceWidget"),P=W({type:c(z)}),E=W({type:c(L)}),N=W(l),S=W(p),w((I=t((C=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];return t=e.call.apply(e,[this].concat(o))||this,i(t,"type",I,r(t)),i(t,"side",k,r(t)),i(t,"sp",K,r(t)),i(t,"row",D,r(t)),i(t,"col",R,r(t)),i(t,"lbCount",M,r(t)),t}n(t,e);var a=t.prototype;return a.init=function(e,t,n,i){this.row=e,this.col=t,this.type=n,this.side=i,this.updateSprite()},a.updateSprite=function(){var e=this.side===L.RED?"red":"black",t=T.skinsMgr.getSkinManager(m.COTUONG);this.type===z.TUONG||this.type!=z.NONE?this.getComponentInChildren(l).spriteFrame=t.getAssetsBySkinId(e,this.type):this.sp.spriteFrame=t.getAssetsBySkinId(e,z.NONE)},a.onMovePiece=function(){var e=o(s().mark((function e(n){var i,r,o,a,u,c=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=n.node.getComponentInChildren(t))&&(i.node.removeFromParent(),T.eventMgr.emit(O.PUT_TO_POOL,i.node)),r=n.node.getWorldPosition(),o=this.node.parent,a=o.getComponent(g)){e.next=8;break}return console.error("Không tìm thấy UITransform trên parent"),e.abrupt("return");case 8:return u=a.convertToNodeSpaceAR(r),e.next=11,new Promise((function(e){f(c.node).to(.2,{position:u},{easing:"sineOut"}).call((function(){c.node.parent=n.node,c.node.setPosition(h.ZERO),b(v.effect,"piece",!0,!1),c.row=n.pos.row,c.col=n.pos.col,T.eventMgr.emit(O.SHOW_HISTORY),e()})).start()}));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),a.show=function(e,t,n){void 0!==t&&(this.side=t),!isNaN(null==n?void 0:n.count)&&(null==n?void 0:n.count)>1?(this.lbCount.string=null==n?void 0:n.count.toString(),this.lbCount.node.parent.active=!0):this.lbCount.node.parent.active=!1,(null==n?void 0:n.type)==z.NONE&&null!=n&&n.realType?this.sp.color=new d("ADADAD"):this.sp.color=d.WHITE,this.type=e,this.updateSprite()},a.active=function(){this.sp.color=d.YELLOW},a.unActive=function(){this.sp.color=d.WHITE},t}(y)).prototype,"type",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return z.TUONG}}),k=t(C.prototype,"side",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return L.RED}}),K=t(C.prototype,"sp",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=t(C.prototype,"row",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),R=t(C.prototype,"col",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),M=t(C.prototype,"lbCount",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=C))||A));a._RF.pop()}}}));

System.register("chunks:///_virtual/KKTileCoTuongWidget.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIBase.ts","./KKPieceWidget.ts","./kk.ts","./MessageEvent.ts","./GameCoTuongData.ts"],(function(t){var e,i,n,o,r,c,a,u,s,l,f,p,h,g;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,o=t.assertThisInitialized,r=t.createClass},function(t){c=t.cclegacy,a=t._decorator,u=t.CCInteger,s=t.Node},function(t){l=t.UIBase},function(t){f=t.KKPieceWidget},function(t){p=t.default},function(t){h=t.MessageEventType},function(t){g=t.default}],execute:function(){var v,y,d,b,m,T,w,C,I,K,k,E,_,M,z;c._RF.push({},"2893eH5wkpIK4mi8YTsHRA2","KKTileCoTuongWidget",void 0);var H=a.ccclass,D=a.property;a.type,t("KKTileCoTuongWidget",(v=H("KKTileCoTuongWidget"),y=D(u),d=D(u),b=D({type:s}),m=D({type:s}),T=D({type:s}),w=D({type:s}),v((K=e((I=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),c=0;c<i;c++)r[c]=arguments[c];return e=t.call.apply(t,[this].concat(r))||this,n(e,"row",K,o(e)),n(e,"col",k,o(e)),n(e,"position",E,o(e)),n(e,"attack",_,o(e)),n(e,"from",M,o(e)),n(e,"to",z,o(e)),e}i(e,t);var c=e.prototype;return c.onLoad=function(){p.eventMgr.on(h.HIDE_TILE,this.hide,this),p.eventMgr.on(h.HIDE_TILE_HISTORY,this.hideHistory,this)},c.onDestroy=function(){p.eventMgr.offTargetAll(this)},c.init=function(t,e){this.row=t,this.col=e},c.activeAttack=function(){this.attack.active=!0},c.active=function(){this.position.active=!0},c.showFrom=function(){this.from.active=!0},c.showTo=function(){this.to.active=!0},c.hide=function(){this.position.active=!1,this.attack.active=!1},c.hideHistory=function(){this.from.active=!1,this.to.active=!1},c.onBtnClick=function(t,e){if(!g.isViewer)switch(e){case"move":var i=this.node.getComponentInChildren(f);p.eventMgr.emit(h.ON_SELECT_TILE,i),p.eventMgr.emit(h.ON_MOVE_PIECE,this)}},r(e,[{key:"pos",get:function(){return{row:this.row,col:this.col}}},{key:"piece",get:function(){return this.node.getComponentInChildren(f)}}]),e}(l)).prototype,"row",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),k=e(I.prototype,"col",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),E=e(I.prototype,"position",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(I.prototype,"attack",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(I.prototype,"from",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(I.prototype,"to",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=I))||C));c._RF.pop()}}}));

System.register("chunks:///_virtual/Xiangqi.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var r,n;return{setters:[function(e){r=e.extends},function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"114657O5BRIh61V3YJDFVX+","Xiangqi",void 0);e("default",(function(e){console.log("Xiangqi init");var n="b",t="r",i=-1,o="p",u="c",s="r",a="n",f="b",l="a",p="k",c="rnbakabnr/9/1c5c1/p1p1p1p1p/9/9/P1P1P1P1P/1C5C1/9/RNBAKABNR r - - 0 1",h=Object.freeze(["1-0","0-1","1/2-1/2","*"]),d=Object.freeze({b:[16,-1,1],r:[-16,-1,1]}),v=Object.freeze({c:[-16,16,-1,1],r:[-16,16,-1,1],n:[-33,-31,31,33,-18,14,-14,18],b:[-34,34,30,-30],a:[-17,17,15,-15],k:[-16,16,-1,1]}),g=Object.freeze({NORMAL:"n",CAPTURE:"c"}),b=Object.freeze({NORMAL:1,CAPTURE:2}),m=Object.freeze({a9:0,b9:1,c9:2,d9:3,e9:4,f9:5,g9:6,h9:7,i9:8,a8:16,b8:17,c8:18,d8:19,e8:20,f8:21,g8:22,h8:23,i8:24,a7:32,b7:33,c7:34,d7:35,e7:36,f7:37,g7:38,h7:39,i7:40,a6:48,b6:49,c6:50,d6:51,e6:52,f6:53,g6:54,h6:55,i6:56,a5:64,b5:65,c5:66,d5:67,e5:68,f5:69,g5:70,h5:71,i5:72,a4:80,b4:81,c4:82,d4:83,e4:84,f4:85,g4:86,h4:87,i4:88,a3:96,b3:97,c3:98,d3:99,e3:100,f3:101,g3:102,h3:103,i3:104,a2:112,b2:113,c2:114,d2:115,e2:116,f2:117,g2:118,h2:119,i2:120,a1:128,b1:129,c1:130,d1:131,e1:132,f1:133,g1:134,h1:135,i1:136,a0:144,b0:145,c0:146,d0:147,e0:148,f0:149,g0:150,h0:151,i0:152}),y=new Array(256),q={r:i,b:i},w=t,A=0,R=1,k=[],N=[],_={};function O(e){void 0===e&&(e=!1),y=new Array(256),q={r:i,b:i},w=t,A=0,R=1,k=[],N=[],e||(_={}),I(E())}function C(){P(c)}function P(e,r){if(void 0===r&&(r=!1),!j(e).valid)return!1;var i,o,u=e.split(/\s+/),s=u[0],a=0;O(r);for(var f=0;f<s.length;++f)"/"===(i=s.charAt(f))?a+=7:-1!=="0123456789".indexOf(i)?a+=parseInt(i,10):(o=i<"a"?t:n,L({type:i.toLowerCase(),color:o},Y(a)),a++);return w=u[1]===n?n:t,A=parseInt(u[4],10),R=parseInt(u[5],10),I(E()),!0}function j(e){var r={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) should be '-'.",5:"3rd field (castling availability) should be '-'.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 10 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"1st field (piece positions) is invalid [each side has one king].",12:"1st field (piece positions) is invalid [each side has no more than 2 advisers].",13:"1st field (piece positions) is invalid [each side has no more than 2 bishops].",14:"1st field (piece positions) is invalid [each side has no more than 2 knights].",15:"1st field (piece positions) is invalid [each side has no more than 2 rooks].",16:"1st field (piece positions) is invalid [each side has no more than 2 cannons].",17:"1st field (piece positions) is invalid [each side has no more than 5 pawns].",18:"1st field (piece positions) is invalid [black king should at right position].",19:"1st field (piece positions) is invalid [red king should at right position].",20:"1st field (piece positions) is invalid [black adviser should at right position].",21:"1st field (piece positions) is invalid [red adviser should at right position].",22:"1st field (piece positions) is invalid [black bishop should at right position].",23:"1st field (piece positions) is invalid [red bishop should at right position].",24:"1st field (piece positions) is invalid [black pawn should at right position].",25:"1st field (piece positions) is invalid [red pawn should at right position]."};function i(e){return{valid:0===e,error_number:e,error:r[e]}}var u=e.split(/\s+/);if(6!==u.length)return i(1);if(isNaN(u[5])||parseInt(u[5],10)<=0)return i(2);if(isNaN(u[4])||parseInt(u[4],10)<0)return i(3);if(!/^-$/.test(u[3]))return i(4);if(!/^-$/.test(u[2]))return i(5);if(!/^([rwb])$/.test(u[1]))return i(6);var s=u[0].split("/");if(10!==s.length)return i(7);var a,c,h,d,v={p:{number:0,squares:[]},P:{number:0,squares:[]},c:{number:0,squares:[]},C:{number:0,squares:[]},r:{number:0,squares:[]},R:{number:0,squares:[]},n:{number:0,squares:[]},N:{number:0,squares:[]},b:{number:0,squares:[]},B:{number:0,squares:[]},a:{number:0,squares:[]},A:{number:0,squares:[]},k:{number:0,squares:[]},K:{number:0,squares:[]}};for(a=0;a<s.length;a++){for(h=0,d=!1,c=0;c<s[a].length;c++)if(isNaN(s[a][c])){try{++v[s[a][c]].number}catch(e){return i(9)}v[s[a][c]].squares.push(a<<4|h),h+=1,d=!1}else{if(d)return i(8);h+=parseInt(s[a][c],10),d=!0}if(9!==h)return i(10)}if(1!==v.k.number||1!==v.K.number)return i(11);if(v.a.number>2||v.A.number>2)return i(12);if(v.b.number>2||v.B.number>2)return i(13);if(v.n.number>2||v.N.number>2)return i(14);if(v.r.number>2||v.R.number>2)return i(15);if(v.c.number>2||v.C.number>2)return i(16);if(v.p.number>5||v.P.number>5)return i(17);if(te(p,v.k.squares[0],n))return i(18);if(te(p,v.K.squares[0],t))return i(19);for(a=0;a<v.a.squares.length;++a)if(te(l,v.a.squares[a],n))return i(20);for(a=0;a<v.A.squares.length;++a)if(te(l,v.A.squares[a],t))return i(21);for(a=0;a<v.b.squares.length;++a)if(te(f,v.b.squares[a],n))return i(22);for(a=0;a<v.B.squares.length;++a)if(te(f,v.B.squares[a],t))return i(23);for(a=0;a<v.p.squares.length;++a)if(te(o,v.p.squares[a],n))return i(24);for(a=0;a<v.P.squares.length;++a)if(te(o,v.P.squares[a],t))return i(25);return i(0)}function E(){for(var e,r,n=0,i="",o=m.a9;o<=m.i0;++o)null==y[o]?n++:(n>0&&(i+=n,n=0),e=y[o].color,r=y[o].type,i+=e===t?r.toUpperCase():r.toLowerCase()),W(o)>=8&&(n>0&&(i+=n),o!==m.i0&&(i+="/"),n=0,o+=7);return[i,w,"-","-",A,R].join(" ")}function x(e){for(var r=0;r<e.length;r+=2)"string"==typeof e[r]&&"string"==typeof e[r+1]&&(_[e[r]]=e[r+1]);return _}function I(e){k.length>0||(e!==c?_.FEN=e:delete _.FEN)}function B(e){var r=y[m[e]];return r?{type:r.type,color:r.color}:null}function L(e,r){if(!("type"in e)||!("color"in e))return!1;if(-1==="pcrnbakPCRNBAK".indexOf(e.type.toLowerCase()))return!1;if(!(r in m))return!1;var n=m[r];return(e.type!==p||q[e.color]===i||q[e.color]===n)&&(!te(e.type,n,e.color)&&(y[n]={type:e.type,color:e.color},e.type===p&&(q[e.color]=n),I(E()),!0))}function U(e){function r(e,r,n,t,i){r.push(function(e,r,n,t){var i={color:w,from:r,to:n,flags:t,piece:e[r].type};return e[n]&&(i.captured=e[n].type),i}(e,n,t,i))}var n,t,i,c,h,g,q,A,R=[],k=w,N=ee(k),_=m.a9,O=m.i0,C=void 0===e||!("legal"in e)||e.legal,P=void 0!==e&&"opponent"in e&&e.opponent;if(void 0!==e&&"square"in e){if(!(e.square in m))return[];_=O=m[e.square]}for(P&&(w=ee(w),N=ee(k=w)),n=_;n<=O;++n)if(null!=(c=y[n])&&c.color===k){for(t=0,i=(h=c.type===o?d[k]:v[c.type]).length;t<i&&(!(c.type===o&&t>0)||re(n,k));++t)for(g=h[t],q=n,A=!1;!(ne(q+=g)||c.type===a&&ie(n,t)||c.type===f&&(oe(n,t)||re(q,k))||(c.type===l||c.type===p)&&te(c.type,q,k));){if(null==y[q]){if(c.type===u&&A)continue;r(y,R,n,q,b.NORMAL)}else{if(c.type!==u){y[q].color===N&&r(y,R,n,q,b.CAPTURE);break}if(A){y[q].color===N&&r(y,R,n,q,b.CAPTURE);break}A=!0}if(c.type!==u&&c.type!==s)break}W(n)>=8&&(n+=7)}if(!C)return R;var j=[];for(n=0,i=R.length;n<i;n++)D(R[n]),K(k)||j.push(R[n]),V();return P&&(w=ee(w)),j}function F(e,r){return Y(e.from)+Y(e.to)}function $(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function K(e){var r,n,t,i=q[e],f=ee(e);for(r=0,n=v.n.length;r<n;++r)if(t=i+v.n[r],null!=y[t]&&!ne(t)&&y[t].color===f&&y[t].type===a&&!ie(t,r<4?3-r:11-r))return!0;for(r=0,n=v.r.length;r<n;++r){var l=v.r[r],c=!1;for(t=i+l;!ne(t);t+=l){var h=y[t];if(null!=h){if(h.color===f)if(c){if(h.type===u)return!0}else if(h.type===s||h.type===p)return!0;if(c)break;c=!0}}}for(r=0,n=d[f].length;r<n;++r)if(t=i-d[f][r],null!=y[t]&&!ne(t)&&y[t].color===f&&y[t].type===o)return!0;return!1}function z(){return K(w)}function T(){return z()&&0===U().length}function S(){return!z()&&0===U().length}function M(){var e,r={},n=0;for(var t in m)m.hasOwnProperty(t)&&(e=y[m[t]])&&(r[e.type]=e.type in r?r[e.type]+1:1,n++);return 2===n||void 0===r.n&&void 0===r.r&&void 0===r.c&&void 0===r.p}function H(){for(var e,r=[],n={},t=!1;e=V();)r.push(e);for(;;){var i=E().split(" ").slice(0,2).join(" ");if(n[i]=i in n?n[i]+1:1,n[i]>=8&&(t=!0),!r.length)break;D(r.pop())}return t}function X(e,r){e.push({move:r,kings:{b:q.b,r:q.r},turn:w,half_moves:A,move_number:R})}function D(e){X(k,e),null!=y[e.to]&&y[e.to].type===p&&(q[y[e.to].color]=i),y[e.to]=y[e.from],y[e.from]=null,y[e.to].type===p&&(q[y[e.to].color]=e.to),e.flags&b.CAPTURE?A=0:A++,w===n&&R++,w=ee(w)}function G(e,r){if(void 0===r&&(r=!0),null==e)return null;var n=e.move;return q=e.kings,w=e.turn,A=e.half_moves,R=e.move_number,y[n.from]=y[n.to],y[n.from].type=n.piece,y[n.to]=null,(n.flags&b.CAPTURE)>0&&r&&(y[n.to]={type:n.captured,color:ee(w)}),n}function V(){return G(k.pop())}function Z(){for(var e="   +---------------------------+\n",r=m.a9;r<=m.i0;r++){if(0===W(r)&&(e+=" "+"9876543210"[Q(r)]+" |"),null==y[r])e+=" . ";else{var n=y[r].type;e+=" "+(y[r].color===t?n.toUpperCase():n.toLowerCase())+" "}8&r&&(e+="|\n",r+=7)}return e+="   +---------------------------+\n",e+="     a  b  c  d  e  f  g  h  i\n"}function J(e,r){var n,t,i,o=$(e),u=o.match(/([a-iA-I][0-9])-?([a-iA-I][0-9])/);r&&u&&(n=u[1],t=u[2],i=u[3]);for(var s=U(),a=0,f=s.length;a<f;a++){if(o===$(F(s[a]))||r&&o===$(F(s[a])))return s[a];if(u&&(!n||n.toLowerCase()===s[a].piece)&&m[t]===s[a].from&&m[i]===s[a].to)return s[a]}return null}function Q(e){return e>>4}function W(e){return 15&e}function Y(e){var r=W(e),n=Q(e);return"abcdefghi".substring(r,r+1)+"9876543210".substring(n,n+1)}function ee(e){return e===t?n:t}function re(e,r){return r===t?Q(e)<5:Q(e)>4}function ne(e){return e<0||Q(e)>9||W(e)>8}function te(e,r,n){var i={};if(e===o)return i=[0,2,4,6,8],n===t?Q(r)>6||Q(r)>4&&-1===i.indexOf(W(r)):Q(r)<3||Q(r)<5&&-1===i.indexOf(W(r));if(e===f)i.r=[146,150,112,116,120,82,86],i.b=[2,6,32,36,40,66,70];else if(e===l)i.r=[147,149,132,115,117],i.b=[3,5,20,35,37];else{if(e!==p)return ne(r);i.r=[147,148,149,131,132,133,115,116,117],i.b=[3,4,5,19,20,21,35,36,37]}return-1===i[n].indexOf(r)}function ie(e,r){return null!=y[e+[-16,16,-1,1][Math.floor(r/2)]]}function oe(e,r){return null!=y[e+[-17,17,15,-15][r]]}function ue(e){var r=se(e);r.iccs=F(r),r.to=Y(r.to),r.from=Y(r.from),r.piece=w===t?r.piece.toUpperCase():r.piece;var n="";for(var i in b)(b[i]&r.flags)>0&&(n+=g[i]);return r.flags=n,r}function se(e){var r=e instanceof Array?[]:{};for(var n in e)r[n]="object"==typeof n?se(e[n]):e[n];return r}function ae(e){return e.replace(/^\s+|\s+$/g,"")}function fe(e){for(var r=U({legal:!1}),n=0,t=0,i=r.length;t<i;t++){if(D(r[t]),!K(w))if(e-1>0)n+=fe(e-1);else n++;V()}return n}return P(void 0===e?c:e),{RED:t,BLACK:n,PAWN:o,CANNON:u,ROOK:s,KNIGHT:a,BISHOP:f,ADVISER:l,KING:p,SQUARES:function(){for(var e=[],r=m.a9;r<=m.i0;r++)9!==W(r)?e.push(Y(r)):r+=6;return e}(),FLAGS:g,load:function(e){return P(e)},reset:function(){return C()},moves:function(e){for(var r=U(e),n=[],t=0,i=r.length;t<i;t++)void 0!==e&&"verbose"in e&&e.verbose?n.push(ue(r[t])):n.push(F(r[t]));return n},in_check:function(){return z()},in_checkmate:function(){return T()},in_stalemate:function(){return S()},in_draw:function(){return A>=120||H()||M()},insufficient_material:function(){return M()},in_threefold_repetition:function(){return H()},game_over:function(){return A>=120||T()||S()||M()||H()||q[ee(w)]===i},validate_fen:function(e){return j(e)},fen:function(){return E()},board:function(){for(var e=[],r=[],n=m.a9;n<=m.i0;n++)null==y[n]?r.push(null):r.push({type:y[n].type,color:y[n].color}),8&n&&(e.push(r),r=[],n+=7);return e},pgn:function(e){var r,n="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",t="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,i=[],o=!1;for(r in _)i.push("["+r+' "'+_[r]+'"]'+n),o=!0;o&&k.length&&i.push(n);for(var u=[];k.length>0;)u.push(V());for(var s=[],a="";u.length>0;){var f=u.pop();k.length||"b"!==f.color?"b"!==f.color&&(a.length&&s.push(a),a=R+"."):a=R+". ...",a=a+" "+F(f),D(f)}if(a.length&&s.push(a),void 0!==_.Result&&s.push(_.Result),0===t)return i.join("")+s.join(" ");var l=0;for(r=0;r<s.length;r++)l+s[r].length>t&&0!==r?(" "===i[i.length-1]&&i.pop(),i.push(n),l=0):0!==r&&(i.push(" "),l++),i.push(s[r]),l+=s[r].length;return i.join("")},load_pgn:function(e,r){var n=void 0!==r&&"sloppy"in r&&r.sloppy;function t(e){return e.replace(/\\/g,"\\")}var i="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\r?\n",o=new RegExp("^(?:\\s)*(((?:"+t(i)+")*\\[[^\\]]+\\])+)"),u=o.test(e)?o.exec(e)[1]:"";C();var s=function(e,r){for(var n="object"==typeof r&&"string"==typeof r.newline_char?r.newline_char:"\r?\n",i={},o=e.split(new RegExp(t(n))),u="",s="",a=0;a<o.length;a++)u=o[a].replace(/^\[([A-Z][A-Za-z]*)\s.*]$/,"$1"),s=o[a].replace(/^\[[A-Za-z]+\s"(.*)"]$/,"$1"),ae(u).length>0&&(i[u]=s);return i}(u,r);for(var a in s)s.hasOwnProperty(a)&&x([a,s[a]]);if("FEN"in s&&!P(s.FEN,!0))return console.warn("load header FEN failed!"),!1;var f=e.replace(u,"").replace(new RegExp(t(i),"g")," ");f=f.replace(/({[^}]+})+?/g,"");for(var l=/(\([^()]+\))+?/g;l.test(f);)f=f.replace(l,"");var p=ae(f=(f=(f=f.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));p=p.join(",").replace(/,,+/g,",").split(",");for(var c="",d=0;d<p.length-1;d++){if(null==(c=J(p[d],n)))return console.warn("impossible move: "+p[d]+"!\n"+Z()),!1;D(c)}if(c=p[p.length-1],h.indexOf(c)>-1)(function(e){for(var r in e)if(e.hasOwnProperty(r))return!0;return!1})(_)&&void 0===_.Result&&x(["Result",c]);else{if(null==(c=J(c,n)))return console.warn("impossible last move: "+p[p.length-1]+"!\n"+Z()),!1;D(c)}return!0},header:function(){return x(arguments)},ascii:function(){return Z()},turn:function(){return w},move:function(e,r){var n=void 0!==r&&"sloppy"in r&&r.sloppy,t=null;if("string"==typeof e)t=J(e,n);else if("object"==typeof e)for(var i=U(),o=0,u=i.length;o<u;o++)if(e.from===Y(i[o].from)&&e.to===Y(i[o].to)&&!(""in i[o])){t=i[o];break}if(!t)return null;var s=ue(t);return D(t),N=[],s},undo:function(){X(N,null);var e=V();if(e){var r=ue(e),n=[e.to,e.from];return e.from=n[0],e.to=n[1],N[N.length-1].move=e,r}return N.pop(),null},redo:function(){X(k,null);var e=G(N.pop(),!1);if(e){var r=[e.to,e.from];return e.from=r[0],e.to=r[1],k[k.length-1].move=e,ue(e)}return k.pop(),null},clear:function(){return O()},put:function(e,r){return L(e,r)},get:function(e){return B(e)},remove:function(e){return function(e){var r=B(e);return y[m[e]]=null,r&&r.type===p&&(q[r.color]=i),I(E()),r}(e)},perft:function(e){return fe(e)},getHistory:function(){return k.map((function(e){var n=e.move;return r({},n,{from:Y(n.from),to:Y(n.to),piece:w===t?n.piece.toUpperCase():n.piece})}))},history:function(e){for(var r=[],n=[],t=(void 0!==e&&"verbose"in e&&e.verbose);k.length>0;)r.push(V());for(;r.length>0;){var i=r.pop();t?n.push(ue(i)):n.push(F(i)),D(i)}return n}}}));n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/KKCoTuongBundle', 'chunks:///_virtual/KKCoTuongBundle'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});